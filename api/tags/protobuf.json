{"name":"protobuf","slug":"protobuf","count":1,"postlist":[{"title":"Java使用GoogleProtocolBuffer简单说明","slug":"Java使用GoogleProtocolBuffer简单说明","date":"2018-12-11T10:30:34.000Z","updated":"2018-12-11T10:30:34.117Z","comments":true,"path":"api/articles/Java使用GoogleProtocolBuffer简单说明.json","excerpt":"","keywords":null,"cover":null,"content":"<p>![image][<a href=\"http://static.oschina.net/uploads/space/2015/1203/145344_36DW_2370543.png]\" target=\"_blank\" rel=\"noopener\">http://static.oschina.net/uploads/space/2015/1203/145344_36DW_2370543.png]</a></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###关于数据结构文件的描述符的含义</span></span><br><span class=\"line\">1.required  （表示必须存在）</span><br><span class=\"line\">2.optional  （表示可选，不一定需要有值）</span><br><span class=\"line\">3.repeated  （表示集合类）</span><br><span class=\"line\"><span class=\"comment\">###定义一个简单的数据结构</span></span><br></pre></td></tr></table></figure></div>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.test;</span><br><span class=\"line\"></span><br><span class=\"line\">option java_outer_classname = <span class=\"string\">\"PersonData\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">message person &#123;  </span><br><span class=\"line\">    <span class=\"comment\">// ID（必需）  </span></span><br><span class=\"line\">    required int32 id = <span class=\"number\">1</span>;  </span><br><span class=\"line\">    <span class=\"comment\">// 姓名（必需）  </span></span><br><span class=\"line\">    required string name = <span class=\"number\">2</span> [<span class=\"keyword\">default</span> = <span class=\"string\">'Test'</span>]; </span><br><span class=\"line\">    <span class=\"comment\">// 年龄（可选）  </span></span><br><span class=\"line\">    optional string age= <span class=\"number\">3</span>;  </span><br><span class=\"line\">    <span class=\"comment\">// 朋友的引用（集合）  </span></span><br><span class=\"line\">    repeated int32 ids= <span class=\"number\">4</span> [packed=<span class=\"keyword\">true</span>];  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 使用protoc工具转换为Java类</span></span><br><span class=\"line\"><span class=\"comment\">###参数：-I 表示结构文件所在的目录，</span></span><br><span class=\"line\"><span class=\"comment\">####    --java_out 表示输出的文件目录</span></span><br><span class=\"line\"><span class=\"comment\">####  第三个参数person.proto 表示使用的是哪个结构文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">protoc -I=.\\ --java_out=.\\ person.proto</span><br></pre></td></tr></table></figure></div>\n<p>转换完成后把java文件考入对应的java包中，并在项目中引入</p>\n<p>GoogleProtocolBuffer的使用jar包<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.protobuf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>protobuf-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>以下是生成后的Java测试:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.k.ctc.code;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.test.PersonData;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2015-11-23 17:54:48</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Desc</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainLauncher</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> time1 = System.currentTimeMillis();</span><br><span class=\"line\">        PersonData.person p = PersonData.person.newBuilder().setId(<span class=\"number\">1</span>).setAge(<span class=\"string\">\"18\"</span>).setName(<span class=\"string\">\"LiLei\"</span>).build();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(p);</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] bytes = p.toByteArray();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(bytes.length);</span><br><span class=\"line\">        PersonData.person p1 = PersonData.person.parseFrom(bytes);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(p1);</span><br><span class=\"line\">        <span class=\"keyword\">long</span> time2 = System.currentTimeMillis();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"time:\"</span> + (time2 - time1));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>执行结果是:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">======================================</span><br><span class=\"line\">id: 1</span><br><span class=\"line\">name: <span class=\"string\">\"LiLei\"</span></span><br><span class=\"line\">age: <span class=\"string\">\"18\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">======================================</span><br><span class=\"line\">13</span><br><span class=\"line\">======================================</span><br><span class=\"line\">id: 1</span><br><span class=\"line\">name: <span class=\"string\">\"LiLei\"</span></span><br><span class=\"line\">age: <span class=\"string\">\"18\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">======================================</span><br><span class=\"line\">time:125</span><br></pre></td></tr></table></figure></div></p>\n","text":"![image][http://static.oschina.net/uploads/space/2015/1203/145344_36DW_2370543.png]1<br>2<br>3<br>4<br>5<br>###关于数据结构文件的描述符的含义<br>1.required","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"protobuf","slug":"java/protobuf","count":1,"path":"api/categories/java/protobuf.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"protobuf","slug":"protobuf","count":1,"path":"api/tags/protobuf.json"}]}]}