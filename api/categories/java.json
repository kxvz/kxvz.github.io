{"name":"java","slug":"java","count":21,"postlist":[{"title":"Dump Java内存信息","slug":"Dump-Java内存信息","date":"2018-12-11T09:23:24.000Z","updated":"2018-12-12T02:06:46.725Z","comments":true,"path":"api/articles/Dump-Java内存信息.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"Dump-Java内存信息\"><a href=\"#Dump-Java内存信息\" class=\"headerlink\" title=\"Dump Java内存信息\"></a>Dump Java内存信息</h1><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"CMD\"><figure class=\"iseeu highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PID -&gt; <span class=\"number\">9574</span></span><br><span class=\"line\"></span><br><span class=\"line\">jmap -dump:<span class=\"built_in\">format</span>=b,file=/tmp/bak1.bin <span class=\"number\">9574</span></span><br><span class=\"line\"></span><br><span class=\"line\">jstack -l <span class=\"number\">9574</span> &gt;&gt; /tmp/bak1.log</span><br><span class=\"line\"></span><br><span class=\"line\">### 线程</span><br><span class=\"line\">./jstack pid &gt; bak1.log</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### 备份内存中对象</span><br><span class=\"line\">./jmap -dump:<span class=\"built_in\">format</span>=b,file=bak1.bin pid</span><br></pre></td></tr></table></figure></div>","text":"Dump Java内存信息1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>PID -&gt; 9574<br><br>jmap -dump:format=b,file=/tmp/bak1.bin 957","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"jmap","slug":"java/jmap","count":1,"path":"api/categories/java/jmap.json"},{"name":"jstack","slug":"java/jmap/jstack","count":1,"path":"api/categories/java/jmap/jstack.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"jmap","slug":"jmap","count":1,"path":"api/tags/jmap.json"},{"name":"jstack","slug":"jstack","count":1,"path":"api/tags/jstack.json"},{"name":"dump","slug":"dump","count":1,"path":"api/tags/dump.json"}]},{"title":"Java 图片合并类","slug":"Java-图片合并类","date":"2018-12-11T10:22:19.000Z","updated":"2018-12-11T10:22:19.668Z","comments":true,"path":"api/articles/Java-图片合并类.json","excerpt":"","keywords":null,"cover":null,"content":"<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.awt.image.BufferedImage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.File;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.imageio.ImageIO;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ImageHandle</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> BufferedImage <span class=\"title\">marge</span><span class=\"params\">(String first, String last, <span class=\"keyword\">boolean</span> isVertical)</span> </span>&#123;</span><br><span class=\"line\">        BufferedImage one = <span class=\"keyword\">this</span>.readImage(first);</span><br><span class=\"line\">        BufferedImage two = <span class=\"keyword\">this</span>.readImage(last);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (isVertical) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.mergeTwoImageByVertical(one, two);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.mergeTwoImageByHorizontal(one, two);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">saveImage</span><span class=\"params\">(String savePath, BufferedImage image)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            File file = <span class=\"keyword\">new</span> File(savePath);</span><br><span class=\"line\">            ImageIO.write(image, <span class=\"string\">\"jpg\"</span>, file);<span class=\"comment\">// 写图片  </span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException ex) &#123;</span><br><span class=\"line\">            ex.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> BufferedImage <span class=\"title\">mergeTwoImageByVertical</span><span class=\"params\">(BufferedImage one, BufferedImage two)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> width = <span class=\"keyword\">this</span>.getWidth(one);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> height = <span class=\"keyword\">this</span>.getHeight(one);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span>[] oneRPG = <span class=\"keyword\">this</span>.readImageRPG(one);</span><br><span class=\"line\">        <span class=\"keyword\">int</span>[] twoRPG = <span class=\"keyword\">this</span>.readImageRPG(two);</span><br><span class=\"line\"></span><br><span class=\"line\">        BufferedImage result = <span class=\"keyword\">new</span> BufferedImage(width, height * <span class=\"number\">2</span>, BufferedImage.TYPE_INT_RGB);</span><br><span class=\"line\">        result.setRGB(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height, oneRPG, <span class=\"number\">0</span>, width);</span><br><span class=\"line\">        result.setRGB(<span class=\"number\">0</span>, height, width, height, twoRPG, <span class=\"number\">0</span>, width);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> BufferedImage <span class=\"title\">mergeTwoImageByHorizontal</span><span class=\"params\">(BufferedImage one, BufferedImage two)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> width = <span class=\"keyword\">this</span>.getWidth(one);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> height = <span class=\"keyword\">this</span>.getHeight(one);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">int</span>[] oneRPG = <span class=\"keyword\">this</span>.readImageRPG(one);</span><br><span class=\"line\">        <span class=\"keyword\">int</span>[] twoRPG = <span class=\"keyword\">this</span>.readImageRPG(two);</span><br><span class=\"line\"></span><br><span class=\"line\">        BufferedImage result = <span class=\"keyword\">new</span> BufferedImage(width * <span class=\"number\">2</span>, height, BufferedImage.TYPE_INT_RGB);</span><br><span class=\"line\">        result.setRGB(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height, oneRPG, <span class=\"number\">0</span>, width);</span><br><span class=\"line\">        result.setRGB(width, <span class=\"number\">0</span>, width, height, twoRPG, <span class=\"number\">0</span>, width);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span>[] readImageRPG(BufferedImage image) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> width = <span class=\"keyword\">this</span>.getWidth(image);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> height = <span class=\"keyword\">this</span>.getHeight(image);</span><br><span class=\"line\">        <span class=\"keyword\">int</span>[] imageRPG = <span class=\"keyword\">new</span> <span class=\"keyword\">int</span>[width * height];<span class=\"comment\">// 从图片中读取RGB  </span></span><br><span class=\"line\">        imageRPG = image.getRGB(<span class=\"number\">0</span>, <span class=\"number\">0</span>, width, height, imageRPG, <span class=\"number\">0</span>, width);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> imageRPG;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">getWidth</span><span class=\"params\">(BufferedImage image)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (image == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> image.getWidth();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">getHeight</span><span class=\"params\">(BufferedImage image)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (image == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> image.getHeight();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> BufferedImage <span class=\"title\">readImage</span><span class=\"params\">(String path)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            File file = <span class=\"keyword\">new</span> File(path);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ImageIO.read(file);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException ex) &#123;</span><br><span class=\"line\">            ex.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n","text":"1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"image","slug":"java/image","count":1,"path":"api/categories/java/image.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"image","slug":"image","count":1,"path":"api/tags/image.json"}]},{"title":"Java 录制语音的实现代码","slug":"Java-录制语音的实现代码","date":"2018-12-11T09:57:15.000Z","updated":"2018-12-11T09:57:15.516Z","comments":true,"path":"api/articles/Java-录制语音的实现代码.json","excerpt":"","keywords":null,"cover":null,"content":"<p>SoundServer 音频录制类:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SoundServer</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    AudioRecord record;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startRecordSound</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            record = <span class=\"keyword\">new</span> AudioRecord();</span><br><span class=\"line\">            record.start();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            LogUtil.error(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] stopRecordSound() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (record != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            record.endRecord();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> record.getBuf();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AudioRecord</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    AudioInputStream audioInputStream;</span><br><span class=\"line\">    TargetDataLine line;</span><br><span class=\"line\">    AudioFileFormat.Type targetType;</span><br><span class=\"line\">    ByteArrayOutputStream bos = <span class=\"keyword\">new</span> ByteArrayOutputStream();</span><br><span class=\"line\">    <span class=\"keyword\">byte</span>[] buf;</span><br><span class=\"line\"> </span><br><span class=\"line\">    AudioRecord() <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        AudioFormat audioFormat = <span class=\"keyword\">new</span> AudioFormat(AudioFormat.Encoding.PCM_SIGNED, <span class=\"number\">16000</span>, <span class=\"number\">8</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>, <span class=\"number\">16000</span>, <span class=\"keyword\">false</span>);</span><br><span class=\"line\">        DataLine.Info info = <span class=\"keyword\">new</span> DataLine.Info(TargetDataLine.class, audioFormat);</span><br><span class=\"line\">        line = (TargetDataLine) AudioSystem.getLine(info);</span><br><span class=\"line\">        line.open(audioFormat);</span><br><span class=\"line\">        audioInputStream = <span class=\"keyword\">new</span> AudioInputStream(line);</span><br><span class=\"line\">        targetType = AudioFileFormat.Type.AU;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">start</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        line.start();</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">endRecord</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        line.stop();</span><br><span class=\"line\">        line.close();</span><br><span class=\"line\">        buf = bos.toByteArray();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] getBuf() &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> buf;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            AudioSystem.write(audioInputStream, targetType, bos);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            LogUtil.error(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>Launcher  测试主类:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Launcher</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        SoundServer ss = <span class=\"keyword\">new</span> SoundServer();</span><br><span class=\"line\">        Scanner sc = <span class=\"keyword\">new</span> Scanner(System.in);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"请输入Start开始：\"</span>);</span><br><span class=\"line\">        String input = sc.nextLine();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"start\"</span>.equalsIgnoreCase(input)) &#123;</span><br><span class=\"line\">            ss.startRecordSound();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"请输入End结束：\"</span>);</span><br><span class=\"line\">        input = sc.nextLine();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">\"end\"</span>.equalsIgnoreCase(input)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">byte</span>[] voice = ss.stopRecordSound();</span><br><span class=\"line\">            LogUtil.info(voice);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n","text":"SoundServer 音频录制类:<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>2","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"录音","slug":"java/录音","count":1,"path":"api/categories/java/录音.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"audiorecord","slug":"audiorecord","count":1,"path":"api/tags/audiorecord.json"},{"name":"录音","slug":"录音","count":1,"path":"api/tags/录音.json"}]},{"title":"Java 用反射设置对象的属性值","slug":"Java-用反射设置对象的属性值","date":"2018-12-11T10:04:03.000Z","updated":"2018-12-11T10:04:03.489Z","comments":true,"path":"api/articles/Java-用反射设置对象的属性值.json","excerpt":"","keywords":null,"cover":null,"content":"<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用反射设置对象的属性值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> obj 需要設置值的對象</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> fieldName 需要設置值的屬性</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@param</span> value 需要设置的值</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@return</span> 设置值后的对象</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> Object <span class=\"title\">invoke</span><span class=\"params\">(Object obj, String fieldName, Object value)</span> </span>&#123;</span><br><span class=\"line\">    String firstWord = fieldName.substring(<span class=\"number\">0</span>, <span class=\"number\">1</span>).toUpperCase();</span><br><span class=\"line\">    String methodName = String.format(<span class=\"string\">\"set%s%s\"</span>, firstWord, fieldName.substring(<span class=\"number\">1</span>));</span><br><span class=\"line\">    Method method = obj.getClass().getMethod(methodName, value.getClass());</span><br><span class=\"line\">    method.invoke(obj, value);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>Java 反射 创建对象的方法<br>1、通过Class对象的newInstance()方法，这种方法的局限是只能取调用默认的构造函数</p>\n<p>2、通过取得Class对象的getConstructor方法取得Construtor对象，然后再通过调用Constructor类的newInstance的两个方法</p>\n","text":"1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>/**<br> * 用反射设置对象的属性值<br> * @param obj 需要設置值的對象<br> * @param fiel","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"反射","slug":"java/反射","count":1,"path":"api/categories/java/反射.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"invoke","slug":"invoke","count":1,"path":"api/tags/invoke.json"},{"name":"反射","slug":"反射","count":1,"path":"api/tags/反射.json"}]},{"title":"Java使用AES加密解密时需要的Jar","slug":"Java使用AES加密解密时需要的Jar","date":"2018-12-12T02:05:35.000Z","updated":"2018-12-12T02:05:35.941Z","comments":true,"path":"api/articles/Java使用AES加密解密时需要的Jar.json","excerpt":"","keywords":null,"cover":null,"content":"<p>当使用Java进行AES加密或者解密的时候出现如下错误:</p>\n<p>java.security.InvalidKeyException: Illegal key size or default parameters</p>\n<p>可尝试使用官方的JCE解决:</p>\n<p>下载地址:  <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"noopener\">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p>\n<p>选择当前使用的JDK版本下进行下载:</p>\n<p>找到下面这句描述然后进行下载</p>\n<p>Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files for JDK/JRE  下载<br>下载后解压出来根据README.txt进行操作</p>\n","text":"当使用Java进行AES加密或者解密的时候出现如下错误:java.security.InvalidKeyException: Illegal key size or default parameters可尝试使用官方的JCE解决:下载地址:  http://www.oracle.","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"aes","slug":"java/aes","count":1,"path":"api/categories/java/aes.json"},{"name":"jce","slug":"java/aes/jce","count":1,"path":"api/categories/java/aes/jce.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"aes","slug":"aes","count":1,"path":"api/tags/aes.json"},{"name":"jce","slug":"jce","count":1,"path":"api/tags/jce.json"}]},{"title":"Java使用GoogleProtocolBuffer简单说明","slug":"Java使用GoogleProtocolBuffer简单说明","date":"2018-12-11T10:30:34.000Z","updated":"2018-12-11T10:30:34.117Z","comments":true,"path":"api/articles/Java使用GoogleProtocolBuffer简单说明.json","excerpt":"","keywords":null,"cover":null,"content":"<p>![image][<a href=\"http://static.oschina.net/uploads/space/2015/1203/145344_36DW_2370543.png]\" target=\"_blank\" rel=\"noopener\">http://static.oschina.net/uploads/space/2015/1203/145344_36DW_2370543.png]</a></p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">###关于数据结构文件的描述符的含义</span></span><br><span class=\"line\">1.required  （表示必须存在）</span><br><span class=\"line\">2.optional  （表示可选，不一定需要有值）</span><br><span class=\"line\">3.repeated  （表示集合类）</span><br><span class=\"line\"><span class=\"comment\">###定义一个简单的数据结构</span></span><br></pre></td></tr></table></figure></div>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.test;</span><br><span class=\"line\"></span><br><span class=\"line\">option java_outer_classname = <span class=\"string\">\"PersonData\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">message person &#123;  </span><br><span class=\"line\">    <span class=\"comment\">// ID（必需）  </span></span><br><span class=\"line\">    required int32 id = <span class=\"number\">1</span>;  </span><br><span class=\"line\">    <span class=\"comment\">// 姓名（必需）  </span></span><br><span class=\"line\">    required string name = <span class=\"number\">2</span> [<span class=\"keyword\">default</span> = <span class=\"string\">'Test'</span>]; </span><br><span class=\"line\">    <span class=\"comment\">// 年龄（可选）  </span></span><br><span class=\"line\">    optional string age= <span class=\"number\">3</span>;  </span><br><span class=\"line\">    <span class=\"comment\">// 朋友的引用（集合）  </span></span><br><span class=\"line\">    repeated int32 ids= <span class=\"number\">4</span> [packed=<span class=\"keyword\">true</span>];  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 使用protoc工具转换为Java类</span></span><br><span class=\"line\"><span class=\"comment\">###参数：-I 表示结构文件所在的目录，</span></span><br><span class=\"line\"><span class=\"comment\">####    --java_out 表示输出的文件目录</span></span><br><span class=\"line\"><span class=\"comment\">####  第三个参数person.proto 表示使用的是哪个结构文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">protoc -I=.\\ --java_out=.\\ person.proto</span><br></pre></td></tr></table></figure></div>\n<p>转换完成后把java文件考入对应的java包中，并在项目中引入</p>\n<p>GoogleProtocolBuffer的使用jar包<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.protobuf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>protobuf-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>以下是生成后的Java测试:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.k.ctc.code;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.test.PersonData;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2015-11-23 17:54:48</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Desc</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MainLauncher</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> time1 = System.currentTimeMillis();</span><br><span class=\"line\">        PersonData.person p = PersonData.person.newBuilder().setId(<span class=\"number\">1</span>).setAge(<span class=\"string\">\"18\"</span>).setName(<span class=\"string\">\"LiLei\"</span>).build();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(p);</span><br><span class=\"line\">        <span class=\"keyword\">byte</span>[] bytes = p.toByteArray();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(bytes.length);</span><br><span class=\"line\">        PersonData.person p1 = PersonData.person.parseFrom(bytes);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(p1);</span><br><span class=\"line\">        <span class=\"keyword\">long</span> time2 = System.currentTimeMillis();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"======================================\"</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"time:\"</span> + (time2 - time1));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>执行结果是:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">======================================</span><br><span class=\"line\">id: 1</span><br><span class=\"line\">name: <span class=\"string\">\"LiLei\"</span></span><br><span class=\"line\">age: <span class=\"string\">\"18\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">======================================</span><br><span class=\"line\">13</span><br><span class=\"line\">======================================</span><br><span class=\"line\">id: 1</span><br><span class=\"line\">name: <span class=\"string\">\"LiLei\"</span></span><br><span class=\"line\">age: <span class=\"string\">\"18\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">======================================</span><br><span class=\"line\">time:125</span><br></pre></td></tr></table></figure></div></p>\n","text":"![image][http://static.oschina.net/uploads/space/2015/1203/145344_36DW_2370543.png]1<br>2<br>3<br>4<br>5<br>###关于数据结构文件的描述符的含义<br>1.required","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"protobuf","slug":"java/protobuf","count":1,"path":"api/categories/java/protobuf.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"protobuf","slug":"protobuf","count":1,"path":"api/tags/protobuf.json"}]},{"title":"Java向RocketMQ中发送数据","slug":"Java向RocketMQ中发送数据","date":"2018-12-11T09:43:44.000Z","updated":"2018-12-11T09:43:44.796Z","comments":true,"path":"api/articles/Java向RocketMQ中发送数据.json","excerpt":"","keywords":null,"cover":null,"content":"<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RocketProducer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> DefaultMQProducer producer;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">RocketProducer</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (producer == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                producer = <span class=\"keyword\">new</span> DefaultMQProducer(<span class=\"string\">\"DataRecord\"</span>);</span><br><span class=\"line\">                producer.setNamesrvAddr(<span class=\"string\">\"192.168.1.11:9876\"</span>);</span><br><span class=\"line\">                producer.start();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">                LogUtil.error(ex);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.destory();</span><br><span class=\"line\">                producer = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">send</span><span class=\"params\">(String group, String queue, <span class=\"keyword\">byte</span>[] message)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">            Message msg = <span class=\"keyword\">new</span> Message(group, queue, message);</span><br><span class=\"line\">            SendResult result = producer.send(msg);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (SendStatus.SEND_OK.equals(result.getSendStatus()));</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">destory</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.producer != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.producer.shutdown();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>文档地址: <a href=\"https://rocketmq.incubator.apache.org/docs/best-practice-producer/\" target=\"_blank\" rel=\"noopener\">https://rocketmq.incubator.apache.org/docs/best-practice-producer/</a></p>\n","text":"1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"rocketmq","slug":"java/rocketmq","count":1,"path":"api/categories/java/rocketmq.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"rocketmq","slug":"rocketmq","count":1,"path":"api/tags/rocketmq.json"},{"name":"producer","slug":"producer","count":1,"path":"api/tags/producer.json"}]},{"title":"Java的Excel导出工具类","slug":"Java的Excel导出工具类","date":"2018-12-11T09:08:42.000Z","updated":"2018-12-11T09:08:42.223Z","comments":true,"path":"api/articles/Java的Excel导出工具类.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"Java的Excel导出工具类\"><a href=\"#Java的Excel导出工具类\" class=\"headerlink\" title=\"Java的Excel导出工具类\"></a>Java的Excel导出工具类</h1><p>###首先在POM中引入需要的Jar<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>fastjson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.47<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.poi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>poi<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.poi<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>poi-ooxml<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<h3 id=\"工具类\"><a href=\"#工具类\" class=\"headerlink\" title=\"工具类:\"></a>工具类:</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSON;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.lang.reflect.Field;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Date;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Iterator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.function.Function;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.stream.Collectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.poi.xssf.usermodel.XSSFCell;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.poi.xssf.usermodel.XSSFRow;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.poi.xssf.usermodel.XSSFSheet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Excel</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> XSSFWorkbook workBook = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> XSSFSheet sheet = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Excel</span><span class=\"params\">(String sheetName, String... headers)</span> </span>&#123;</span><br><span class=\"line\">        workBook = <span class=\"keyword\">new</span> XSSFWorkbook();</span><br><span class=\"line\">        sheet = workBook.createSheet(sheetName);</span><br><span class=\"line\"></span><br><span class=\"line\">        XSSFRow titleRow = sheet.createRow((<span class=\"keyword\">short</span>) <span class=\"number\">0</span>);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> index = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String header : headers) &#123;</span><br><span class=\"line\">            XSSFCell cell = titleRow.createCell((<span class=\"keyword\">short</span>) index);</span><br><span class=\"line\">            cell.setCellValue(header);</span><br><span class=\"line\">            index++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Excel</span><span class=\"params\">(String sheetName)</span> </span>&#123;</span><br><span class=\"line\">        workBook = <span class=\"keyword\">new</span> XSSFWorkbook();</span><br><span class=\"line\">        sheet = workBook.createSheet(sheetName);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> Map&lt;String, Field&gt; <span class=\"title\">extract</span><span class=\"params\">(T obj)</span> </span>&#123;</span><br><span class=\"line\">        List&lt;Field&gt; declaredFields = Arrays.asList(obj.getClass().getDeclaredFields());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> declaredFields.stream().collect(Collectors.toMap(Field::getName, Function.identity()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">export</span><span class=\"params\">(OutputStream out)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            workBook.write(out);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException ex) &#123;</span><br><span class=\"line\">            ex.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                out.flush();</span><br><span class=\"line\">                out.close();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (IOException ex) &#123;</span><br><span class=\"line\">                ex.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setDatas</span><span class=\"params\">(Collection&lt;T&gt; dataset, String... fieldNames)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dataset == <span class=\"keyword\">null</span> || fieldNames == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        Iterator&lt;T&gt; it = dataset.iterator();</span><br><span class=\"line\">        <span class=\"keyword\">int</span> y = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (it.hasNext()) &#123;</span><br><span class=\"line\">            y++;</span><br><span class=\"line\">            XSSFRow row = sheet.createRow(y);</span><br><span class=\"line\">            T t = (T) it.next();</span><br><span class=\"line\">            Map&lt;String, Field&gt; fieldMap = <span class=\"keyword\">this</span>.extract(t);</span><br><span class=\"line\">            <span class=\"keyword\">int</span> x = -<span class=\"number\">1</span>;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (String fieldName : fieldNames) &#123;</span><br><span class=\"line\">                Field field = fieldMap.get(fieldName);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (field == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                x++;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    field.setAccessible(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">                    String value;</span><br><span class=\"line\">                    Object obj = field.get(t);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> Date) &#123;</span><br><span class=\"line\">                        value = DateUtil.format((Date) obj, <span class=\"string\">\"yyyy-MM-dd HH:mm:ss\"</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (obj <span class=\"keyword\">instanceof</span> String) &#123;</span><br><span class=\"line\">                        value = String.valueOf(obj);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        value = JSON.toJSONString(obj);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    XSSFCell cell = row.createCell((<span class=\"keyword\">short</span>) x);</span><br><span class=\"line\">                    cell.setCellValue(value);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">                    ex.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"在网页上导出\"><a href=\"#在网页上导出\" class=\"headerlink\" title=\"在网页上导出:\"></a>在网页上导出:</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RequestMapping</span>(value = <span class=\"string\">\"/api/export\"</span>, method = RequestMethod.GET)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">export</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\tList&lt;TmpData&gt; tmps = findTempDate();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tString name = DateUtil.current(<span class=\"string\">\"yyyyMMddHHmmsss\"</span>);</span><br><span class=\"line\">\t\tresponse.setContentType(<span class=\"string\">\"octets/stream\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Content-Disposition\"</span>, <span class=\"string\">\"attachment;filename = \"</span> + name + <span class=\"string\">\".xlsx\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tExcel&lt;TmpData&gt; export = <span class=\"keyword\">new</span> Excel&lt;&gt;(<span class=\"string\">\"查询导出\"</span>, <span class=\"string\">\"账号\"</span>, <span class=\"string\">\"密码\"</span>, <span class=\"string\">\"IP\"</span>);</span><br><span class=\"line\">\t\texport.setDatas(tmps, <span class=\"string\">\"account\"</span>, <span class=\"string\">\"password\"</span>, <span class=\"string\">\"ip\"</span>);</span><br><span class=\"line\">\t\texport.export(response.getOutputStream());</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">catch</span> (IOException ex) &#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>这样就可以了,至于设置样式之类的,各位自行百度吧…</p>\n","text":"Java的Excel导出工具类###首先在POM中引入需要的Jar<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>&lt;dependency&gt;<br>","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"excel","slug":"java/excel","count":1,"path":"api/categories/java/excel.json"},{"name":"poi","slug":"java/excel/poi","count":1,"path":"api/categories/java/excel/poi.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"excel","slug":"excel","count":1,"path":"api/tags/excel.json"},{"name":"poi","slug":"poi","count":1,"path":"api/tags/poi.json"},{"name":"fastjson","slug":"fastjson","count":1,"path":"api/tags/fastjson.json"}]},{"title":"Java读取HttpServletRequest的post数据流","slug":"Java读取HttpServletRequest的post数据流","date":"2018-12-11T10:28:18.000Z","updated":"2018-12-11T10:28:18.365Z","comments":true,"path":"api/articles/Java读取HttpServletRequest的post数据流.json","excerpt":"","keywords":null,"cover":null,"content":"<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">readPostData</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</span><br><span class=\"line\">        StringBuilder result = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            String line;</span><br><span class=\"line\">            BufferedReader reader = request.getReader();</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (<span class=\"keyword\">null</span> != (line = reader.readLine())) &#123;</span><br><span class=\"line\">                result.append(line);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            Log.info(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result.toString();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n","text":"1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>public String readPostData(HttpServletRequest request) &#123;<br>      ","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"readpost","slug":"java/readpost","count":1,"path":"api/categories/java/readpost.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"post","slug":"post","count":1,"path":"api/tags/post.json"},{"name":"request","slug":"request","count":1,"path":"api/tags/request.json"}]},{"title":"Java的Web项目使用DWR简单配置说明","slug":"Java的Web项目使用DWR简单配置说明","date":"2018-12-11T10:35:07.000Z","updated":"2018-12-11T10:35:07.372Z","comments":true,"path":"api/articles/Java的Web项目使用DWR简单配置说明.json","excerpt":"","keywords":null,"cover":null,"content":"<p>首先使用Maven引入DWR的Jar包<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.directwebremoting<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dwr<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.0.1-RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>其次建立一个测试用的Java类</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2016-1-7 14:32:08</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TestDwr</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Call GetName Method!\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Hello:\"</span> + name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>然后配置dwr.xml<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE dwr PUBLIC \"-//GetAhead Limited//DTD Direct Web Remoting 3.0//EN\" \"http://directwebremoting.org/schema/dwr30.dtd\"&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dwr</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">allow</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">create</span> <span class=\"attr\">creator</span>=<span class=\"string\">\"new\"</span> <span class=\"attr\">javascript</span>=<span class=\"string\">\"test\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"page\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"class\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.k.ctc.web.dwr.TestDwr\"</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">create</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">allow</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dwr</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">配置web.xml</span><br><span class=\"line\">```xml</span><br><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd\"</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">version</span>=<span class=\"string\">\"3.1\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>dwr-invoker<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>org.directwebremoting.servlet.DwrServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>debug<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 如果改为false将会能接收其它域的请求，存在安全风险 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>crossDomainSessionSecurity<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 设置超时时间 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>scriptSessionTimeout<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>1800000<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>maxCallCount<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>20<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>config-xml<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>/WEB-INF/conf/dwr.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>dwr-invoker<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/dwr/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>最后在HTML页面中使用<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"HTML\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Dwr Test Demo<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"Content-Type\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"text/html; charset=UTF-8\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">'text/javascript'</span> <span class=\"attr\">src</span>=<span class=\"string\">'/dwr/engine.js'</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">'text/javascript'</span> <span class=\"attr\">src</span>=<span class=\"string\">'/dwr/interface/test.js'</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"keyword\">var</span> reply = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">data</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"result\"</span>).innerText = data;</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">btn_click</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                <span class=\"keyword\">var</span> name = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"name\"</span>).value;</span></span><br><span class=\"line\"><span class=\"undefined\">                test.getName(name, reply);</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"name\"</span>/&gt;</span> <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"GetName\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"btn_click();\"</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"result\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>注意:js的路径需要引用正确,附带说明截图<br>↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ 写好后的测试页面 ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓<br>![image][<a href=\"http://static.oschina.net/uploads/space/2016/0107/151242_zpre_2370543.png]\" target=\"_blank\" rel=\"noopener\">http://static.oschina.net/uploads/space/2016/0107/151242_zpre_2370543.png]</a></p>\n<p>↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ DWR生成的模块列表页面 ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓<br>![image][<a href=\"http://static.oschina.net/uploads/space/2016/0107/151242_fqmL_2370543.png]\" target=\"_blank\" rel=\"noopener\">http://static.oschina.net/uploads/space/2016/0107/151242_fqmL_2370543.png]</a></p>\n<p>↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓ 模块详情页面和需要引用的js路径说明等 ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓<br>![image][<a href=\"http://static.oschina.net/uploads/space/2016/0107/151242_L64D_2370543.jpg]\" target=\"_blank\" rel=\"noopener\">http://static.oschina.net/uploads/space/2016/0107/151242_L64D_2370543.jpg]</a></p>\n","text":"首先使用Maven引入DWR的Jar包<br>1<br>2<br>3<br>4<br>5<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.directwebremoting&lt;/groupId&gt;<br>    &lt;ar","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"web","slug":"java/web","count":1,"path":"api/categories/java/web.json"},{"name":"dwr","slug":"java/web/dwr","count":1,"path":"api/categories/java/web/dwr.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"web","slug":"web","count":1,"path":"api/tags/web.json"},{"name":"dwr","slug":"dwr","count":1,"path":"api/tags/dwr.json"}]},{"title":"Springboot无法访问static的html","slug":"Springboot无法访问static的html","date":"2018-12-11T09:18:08.000Z","updated":"2018-12-11T09:18:08.142Z","comments":true,"path":"api/articles/Springboot无法访问static的html.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"Springboot无法访问static的html\"><a href=\"#Springboot无法访问static的html\" class=\"headerlink\" title=\"Springboot无法访问static的html\"></a>Springboot无法访问static的html</h1><p>在项目中如果使用了</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableWebMvc</span></span><br></pre></td></tr></table></figure></div>\n<p>那么就会自动覆盖了官方给出的</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"CMD\"><figure class=\"iseeu highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/static, /public, META-INF/resources, /resources</span><br></pre></td></tr></table></figure></div>\n<p>存放静态资源的目录。而将静态资源定位于</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"CMD\"><figure class=\"iseeu highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">src/main/webapp</span><br></pre></td></tr></table></figure></div>\n<p>所以当要访问 /static 里面内容的时候不要使用此注解</p>\n","text":"Springboot无法访问static的html在项目中如果使用了1<br>@EnableWebMvc<br>那么就会自动覆盖了官方给出的1<br>/static, /public, META-INF/resources, /resources<br>存放静态资源的目录。而将静","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"spring","slug":"java/spring","count":1,"path":"api/categories/java/spring.json"},{"name":"resources","slug":"java/spring/resources","count":1,"path":"api/categories/java/spring/resources.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"Spring","slug":"Spring","count":1,"path":"api/tags/Spring.json"},{"name":"html","slug":"html","count":1,"path":"api/tags/html.json"},{"name":"resources","slug":"resources","count":1,"path":"api/tags/resources.json"},{"name":"webaoo","slug":"webaoo","count":1,"path":"api/tags/webaoo.json"}]},{"title":"javax.mail发送邮件","slug":"javax-mail发送邮件","date":"2018-12-11T10:26:41.000Z","updated":"2018-12-11T10:26:41.062Z","comments":true,"path":"api/articles/javax-mail发送邮件.json","excerpt":"","keywords":null,"cover":null,"content":"<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* @param fromMail  发送邮箱</span></span><br><span class=\"line\"><span class=\"comment\">   * @param user  发送邮箱账号</span></span><br><span class=\"line\"><span class=\"comment\">   * @param password  邮箱密码</span></span><br><span class=\"line\"><span class=\"comment\">   * @param toMail  接收邮件地址</span></span><br><span class=\"line\"><span class=\"comment\">   * @param mailTitle  邮件标题</span></span><br><span class=\"line\"><span class=\"comment\">   * @param mailContent  邮件内容</span></span><br><span class=\"line\"><span class=\"comment\">   * @throws Exception </span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">sendMail</span><span class=\"params\">(String fromMail, String user, String password, String toMail, String mailTitle, String mailContent)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">       MailSSLSocketFactory sf = <span class=\"keyword\">new</span> MailSSLSocketFactory();</span><br><span class=\"line\">       sf.setTrustAllHosts(<span class=\"keyword\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">       Properties props = <span class=\"keyword\">new</span> Properties();</span><br><span class=\"line\">       props.put(<span class=\"string\">\"mail.smtp.host\"</span>, <span class=\"string\">\"mail.*****.com\"</span>);</span><br><span class=\"line\">       props.put(<span class=\"string\">\"mail.smtp.port\"</span>, <span class=\"number\">465</span>);</span><br><span class=\"line\">       props.put(<span class=\"string\">\"mail.transport.protocol\"</span>, <span class=\"string\">\"smtp\"</span>);</span><br><span class=\"line\">       props.put(<span class=\"string\">\"mail.smtp.auth\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">       props.put(<span class=\"string\">\"mail.smtp.ssl.enable\"</span>, <span class=\"string\">\"true\"</span>);</span><br><span class=\"line\">       props.put(<span class=\"string\">\"mail.smtp.ssl.socketFactory\"</span>, sf);</span><br><span class=\"line\"></span><br><span class=\"line\">       Session session = Session.getInstance(props);</span><br><span class=\"line\"></span><br><span class=\"line\">       MimeMessage message = <span class=\"keyword\">new</span> MimeMessage(session);</span><br><span class=\"line\">       message.setFrom(<span class=\"keyword\">new</span> InternetAddress(fromMail));</span><br><span class=\"line\">       message.setRecipient(Message.RecipientType.TO, <span class=\"keyword\">new</span> InternetAddress(toMail));</span><br><span class=\"line\">       message.setSubject(mailTitle);</span><br><span class=\"line\">       message.setText(mailContent);</span><br><span class=\"line\">       message.setSentDate(<span class=\"keyword\">new</span> Date());</span><br><span class=\"line\">       message.saveChanges();</span><br><span class=\"line\">       Transport transport = session.getTransport();</span><br><span class=\"line\">       transport.connect(user, password);</span><br><span class=\"line\">       transport.sendMessage(message, message.getAllRecipients());</span><br><span class=\"line\">       transport.close();</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure></div>\n<p>下面是需要添加的包：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.mail<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mail<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4.7<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n","text":"1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"mail","slug":"java/mail","count":1,"path":"api/categories/java/mail.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"mail","slug":"mail","count":1,"path":"api/tags/mail.json"}]},{"title":"使用HttpAsyncClient进行异步获取数据","slug":"使用HttpAsyncClient进行异步获取数据","date":"2018-12-11T10:33:13.000Z","updated":"2018-12-11T10:33:13.744Z","comments":true,"path":"api/articles/使用HttpAsyncClient进行异步获取数据.json","excerpt":"","keywords":null,"cover":null,"content":"<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.CountDownLatch;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.HttpResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.concurrent.FutureCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.impl.nio.client.CloseableHttpAsyncClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.impl.nio.client.HttpAsyncClients;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2016-1-6 11:14:56</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Desc</span></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AsyncClient</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 设置HTTP请求的超时配置</span></span><br><span class=\"line\">        RequestConfig config = RequestConfig.custom().setSocketTimeout(<span class=\"number\">3000</span>).setConnectTimeout(<span class=\"number\">3000</span>).build();</span><br><span class=\"line\">        <span class=\"comment\">// 根据配置创建异步的HTTP客户端</span></span><br><span class=\"line\">        CloseableHttpAsyncClient httpclient = HttpAsyncClients.custom().setDefaultRequestConfig(config).build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//运行客户端</span></span><br><span class=\"line\">        httpclient.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//构建5个HTTPGET请求</span></span><br><span class=\"line\">        HttpGet[] requests = <span class=\"keyword\">new</span> HttpGet[]&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> HttpGet(<span class=\"string\">\"https://www.baidu.com/\"</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> HttpGet(<span class=\"string\">\"https://www.baidu.com/\"</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> HttpGet(<span class=\"string\">\"https://www.baidu.com/\"</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> HttpGet(<span class=\"string\">\"https://www.baidu.com/\"</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> HttpGet(<span class=\"string\">\"https://www.baidu.com/\"</span>)&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//创建一个计数器</span></span><br><span class=\"line\">        <span class=\"keyword\">final</span> CountDownLatch latch = <span class=\"keyword\">new</span> CountDownLatch(requests.length);</span><br><span class=\"line\">        <span class=\"comment\">//循环请求</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">final</span> HttpGet get : requests) &#123;</span><br><span class=\"line\">            httpclient.execute(get, <span class=\"keyword\">new</span> FutureCallback&lt;HttpResponse&gt;() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">completed</span><span class=\"params\">(HttpResponse t)</span> </span>&#123;</span><br><span class=\"line\">                    latch.countDown();</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"==================================\"</span>);</span><br><span class=\"line\">                    System.out.println(t.getStatusLine());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">failed</span><span class=\"params\">(Exception excptn)</span> </span>&#123;</span><br><span class=\"line\">                    latch.countDown();</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"HttpGet failed\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">cancelled</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                    latch.countDown();</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">\"HttpGet cancelled\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//等待5个都请求完成</span></span><br><span class=\"line\">        latch.await();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Shutting down\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">//关闭</span></span><br><span class=\"line\">        httpclient.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>以下是使用Maven引用的jar(并不知道是不是都有使用到):<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">httpclient.version</span>&gt;</span>4.4<span class=\"tag\">&lt;/<span class=\"name\">httpclient.version</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"comment\">&lt;!-- HTTP CLIENT START --&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpasyncclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore-nio<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- HTTP CLIENT END --&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n","text":"1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"httpclient","slug":"java/httpclient","count":1,"path":"api/categories/java/httpclient.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"httpclient","slug":"httpclient","count":1,"path":"api/tags/httpclient.json"}]},{"title":"使用mvn打包jar","slug":"使用mvn打包jar","date":"2018-12-11T09:22:36.000Z","updated":"2018-12-11T09:22:36.829Z","comments":true,"path":"api/articles/使用mvn打包jar.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"使用mvn打包jar\"><a href=\"#使用mvn打包jar\" class=\"headerlink\" title=\"使用mvn打包jar\"></a>使用mvn打包jar</h1><p>使用maven打包成可执行的jar文件,需要包含了dependencies的相关jar文件</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"CMD\"><figure class=\"iseeu highlight cmd\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn assembly:assembly</span><br></pre></td></tr></table></figure></div>\n<p>pom.xml中需要使用的plugins<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span>  </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>  </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-jar-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>  </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span>  </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span>  </span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">archive</span>&gt;</span>  </span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">manifest</span>&gt;</span>  </span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">addClasspath</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">addClasspath</span>&gt;</span>  </span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">classpathPrefix</span>&gt;</span>lib/<span class=\"tag\">&lt;/<span class=\"name\">classpathPrefix</span>&gt;</span>  </span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">mainClass</span>&gt;</span>com.your.package.main.class<span class=\"tag\">&lt;/<span class=\"name\">mainClass</span>&gt;</span>  </span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span>  </span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">archive</span>&gt;</span>  </span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span>  </span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span>  </span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span> </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-assembly-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span> </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span> </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span> </span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">archive</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">manifest</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">mainClass</span>&gt;</span>com.your.package.main.class<span class=\"tag\">&lt;/<span class=\"name\">mainClass</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">manifest</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">archive</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">descriptorRefs</span>&gt;</span> </span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">descriptorRef</span>&gt;</span>jar-with-dependencies<span class=\"tag\">&lt;/<span class=\"name\">descriptorRef</span>&gt;</span> </span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">descriptorRefs</span>&gt;</span> </span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span> </span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>假设你的入口java文件路径为:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">com.your.<span class=\"keyword\">package</span>.main.class</span><br></pre></td></tr></table></figure></div></p>\n","text":"使用mvn打包jar使用maven打包成可执行的jar文件,需要包含了dependencies的相关jar文件1<br>mvn assembly:assembly<br>pom.xml中需要使用的plugins<br>1<br>2<br>3<br>4<br>5<br>6<br>7","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"maven","slug":"java/maven","count":1,"path":"api/categories/java/maven.json"},{"name":"jar","slug":"java/maven/jar","count":1,"path":"api/categories/java/maven/jar.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"maven","slug":"maven","count":4,"path":"api/tags/maven.json"},{"name":"jar","slug":"jar","count":2,"path":"api/tags/jar.json"},{"name":"build","slug":"build","count":1,"path":"api/tags/build.json"}]},{"title":"关于测试中使用ArgumentCaptor来验证执行过程中对象的值","slug":"关于测试中使用ArgumentCaptor来验证执行过程中对象的值","date":"2018-12-11T10:07:58.000Z","updated":"2018-12-11T10:07:58.153Z","comments":true,"path":"api/articles/关于测试中使用ArgumentCaptor来验证执行过程中对象的值.json","excerpt":"","keywords":null,"cover":null,"content":"<p>官方的示例：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ArgumentCaptor&lt;Person&gt; argument = ArgumentCaptor.forClass(Person.class);</span><br><span class=\"line\">verify(mock).doSomething(argument.capture());</span><br><span class=\"line\">assertEquals(<span class=\"string\">\"John\"</span>, argument.getValue().getName());</span><br></pre></td></tr></table></figure></div></p>\n<h3 id=\"大体步骤：\"><a href=\"#大体步骤：\" class=\"headerlink\" title=\"大体步骤：\"></a>大体步骤：</h3><p>﻿首先构建ArgumentCaptor需要传入需要被捕获变量的对象，如示例中的Person.class。</p>\n<p>然后在verify调用Mock对象的方法中调用argument.capture()来捕获执行该方法时该变量的值。</p>\n<p>这样取到值后就可以进行值的验证，通过argument.getValue()得到该对象执行时的值。﻿</p>\n<p>关于ArgumentCaptor最多用到的方法：</p>\n<p>argument.capture() 捕获方法参数  </p>\n<p>argument.getValue() 获取方法参数值，如果方法进行了多次调用，它将返回最后一个参数值 </p>\n<p>argument.getAllValues() 方法进行多次调用后，返回多个参数值</p>\n<h3 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h3><p>在使用的时候需要放在需要执行的方法之后，因为verify会验证执行，所以会放在调用方法之后,而不是像调用Mockito.when()设定条件时放在调用方法之前。</p>\n<p>当遇到复杂对象的时候，如：Map&lt;String,Map&lt;String,Long&gt;&gt; 这样的对象的时候，觉得不好取值，可以设断点调试到该处，查看argument的数据结构，再进行取值验证。</p>\n","text":"官方的示例：<br>1<br>2<br>3<br>ArgumentCaptor&lt;Person&gt; argument = ArgumentCaptor.forClass(Person.class);<br>verify(mock).doSomething(argument","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"test","slug":"java/test","count":1,"path":"api/categories/java/test.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"test","slug":"test","count":1,"path":"api/tags/test.json"},{"name":"ArgumentCaptor","slug":"ArgumentCaptor","count":1,"path":"api/tags/ArgumentCaptor.json"}]},{"title":"在spring-starter-redis中实现一个RedisSerializer<T>","slug":"在spring-starter-redis中实现一个RedisSerializer-T","date":"2018-12-11T09:12:53.000Z","updated":"2018-12-11T09:12:53.090Z","comments":true,"path":"api/articles/在spring-starter-redis中实现一个RedisSerializer-T.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"实现一个RedisSerializer用在spring-boot-starter-data-redis中\"><a href=\"#实现一个RedisSerializer用在spring-boot-starter-data-redis中\" class=\"headerlink\" title=\"实现一个RedisSerializer用在spring-boot-starter-data-redis中\"></a>实现一个RedisSerializer<t>用在spring-boot-starter-data-redis中</t></h1><h3 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求:\"></a>需求:</h3><p>因为会使用到Spring-redis作为缓存框架缓存数据,不让程序每次查询都进到数据库中,因此正对不同的数据格式需要进行序列化和反序列化,于是就自己实现了一个简单的序列化类</p>\n<h3 id=\"首先-配置-Springboot-的-redis-配置\"><a href=\"#首先-配置-Springboot-的-redis-配置\" class=\"headerlink\" title=\"首先 配置 Springboot 的 redis 配置\"></a>首先 配置 Springboot 的 redis 配置</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># REDIS (RedisProperties)</span></span><br><span class=\"line\"><span class=\"comment\"># Redis数据库索引（默认为0）</span></span><br><span class=\"line\">spring.redis.database=0  </span><br><span class=\"line\"><span class=\"comment\"># Redis服务器地址</span></span><br><span class=\"line\">spring.redis.host=192.168.0.11</span><br><span class=\"line\"><span class=\"comment\"># Redis服务器连接端口</span></span><br><span class=\"line\">spring.redis.port=6379  </span><br><span class=\"line\"><span class=\"comment\"># Redis服务器连接密码（默认为空）</span></span><br><span class=\"line\">spring.redis.password=ThisIsPass</span><br><span class=\"line\"><span class=\"comment\"># 连接池最大连接数（使用负值表示没有限制）</span></span><br><span class=\"line\">spring.redis.pool.max-active=-1  </span><br><span class=\"line\"><span class=\"comment\"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span></span><br><span class=\"line\">spring.redis.pool.max-wait=-1  </span><br><span class=\"line\"><span class=\"comment\"># 连接池中的最大空闲连接</span></span><br><span class=\"line\">spring.redis.pool.max-idle=8  </span><br><span class=\"line\"><span class=\"comment\"># 连接池中的最小空闲连接</span></span><br><span class=\"line\">spring.redis.pool.min-idle=2  </span><br><span class=\"line\"><span class=\"comment\"># 连接超时时间（毫秒）</span></span><br><span class=\"line\">spring.redis.timeout=50</span><br></pre></td></tr></table></figure>\n<h3 id=\"接下来实现-序列化类-这里使用到了GSON\"><a href=\"#接下来实现-序列化类-这里使用到了GSON\" class=\"headerlink\" title=\"接下来实现 序列化类 (这里使用到了GSON):\"></a>接下来实现 序列化类 (这里使用到了GSON):</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.SerializationException;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisValueSerializer</span>&lt;<span class=\"title\">T</span>&gt; <span class=\"keyword\">implements</span> <span class=\"title\">RedisSerializer</span>&lt;<span class=\"title\">T</span>&gt; </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">byte</span>[] EMPTY_ARRAY = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">byte</span>[] serialize(T t) <span class=\"keyword\">throws</span> SerializationException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> EMPTY_ARRAY;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        String tmp = String.format(<span class=\"string\">\"%s_%s\"</span>, t.getClass().getName(), JsonUtils.obj2Json(t));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> tmp.getBytes(Encode.UTF8);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> T <span class=\"title\">deserialize</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] bytes)</span> <span class=\"keyword\">throws</span> SerializationException </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (bytes == <span class=\"keyword\">null</span> || bytes.length &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            String tmp = <span class=\"keyword\">new</span> String(bytes, Encode.UTF8);</span><br><span class=\"line\">            String className = tmp.substring(<span class=\"number\">0</span>, tmp.indexOf(<span class=\"string\">\"_&#123;\"</span>));</span><br><span class=\"line\">            String json = tmp.substring(tmp.indexOf(<span class=\"string\">\"_&#123;\"</span>) + <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> (T) JsonUtils.json2Obj(json, Class.forName(className));</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class=\"line\">            LogUtils.error(TAG.DEF, <span class=\"keyword\">this</span>.getClass(), <span class=\"string\">\"deserialize\"</span>, ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"然后RedisConfig\"><a href=\"#然后RedisConfig\" class=\"headerlink\" title=\"然后RedisConfig:\"></a>然后RedisConfig:</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cache.CacheManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Primary;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Primary</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RedisConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">CachingConfigurerSupport</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> CacheManager <span class=\"title\">cacheManager</span><span class=\"params\">(RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class=\"line\">        RedisCacheManager rcm = <span class=\"keyword\">new</span> RedisCacheManager(redisTemplate);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rcm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Primary</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> StringRedisTemplate <span class=\"title\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class=\"line\">        StringRedisTemplate template = <span class=\"keyword\">new</span> StringRedisTemplate(factory);</span><br><span class=\"line\">        template.setValueSerializer(<span class=\"keyword\">new</span> RedisValueSerializer&lt;Object&gt;());</span><br><span class=\"line\">        template.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"然后就可以使用缓存注解了\"><a href=\"#然后就可以使用缓存注解了\" class=\"headerlink\" title=\"然后就可以使用缓存注解了:\"></a>然后就可以使用缓存注解了:</h3><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Cacheable</span>(key =<span class=\"string\">\"#p0\"</span>) </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@CachePut</span>(key = <span class=\"string\">\"#p0\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@CacheEvict</span>(key =<span class=\"string\">\"#p0\"</span>,allEntries=<span class=\"keyword\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"注解使用参考\"><a href=\"#注解使用参考\" class=\"headerlink\" title=\"注解使用参考:\"></a>注解使用参考:</h3><p><a href=\"http://blog.csdn.net/sanjay_f/article/details/47372967\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/sanjay_f/article/details/47372967</a></p>\n","text":"实现一个RedisSerializer用在spring-boot-starter-data-redis中需求:因为会使用到Spring-redis作为缓存框架缓存数据,不让程序每次查询都进到数据库中,因此正对不同的数据格式需要进行序列化和反序列化,于是就自己实现了一个简单的序列化","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"redis","slug":"java/redis","count":1,"path":"api/categories/java/redis.json"},{"name":"RedisSerializer","slug":"java/redis/RedisSerializer","count":1,"path":"api/categories/java/redis/RedisSerializer.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"redis","slug":"redis","count":3,"path":"api/tags/redis.json"},{"name":"spring-boot","slug":"spring-boot","count":3,"path":"api/tags/spring-boot.json"},{"name":"RedisSerializer","slug":"RedisSerializer","count":1,"path":"api/tags/RedisSerializer.json"}]},{"title":"获取map中第一个数据值","slug":"获取map中第一个数据值","date":"2018-12-11T10:22:44.000Z","updated":"2018-12-11T10:22:44.739Z","comments":true,"path":"api/articles/获取map中第一个数据值.json","excerpt":"","keywords":null,"cover":null,"content":"<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取map中第一个非空数据值</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> &lt;K&gt; Key的类型</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> &lt;V&gt; Value的类型</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> map 数据源</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 返回的值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;K, V&gt; <span class=\"function\">V <span class=\"title\">getFirstNotNull</span><span class=\"params\">(Map&lt;K, V&gt; map)</span> </span>&#123;</span><br><span class=\"line\">        V obj = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Entry&lt;K, V&gt; entry : map.entrySet()) &#123;</span><br><span class=\"line\">            obj = entry.getValue();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (obj != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n","text":"1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>/**<br>     * 获取map中第一个非空数据值<br>     *<br","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"map","slug":"java/map","count":1,"path":"api/categories/java/map.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"map","slug":"map","count":1,"path":"api/tags/map.json"}]},{"title":"通过Java操作ActiveMQ的代码记录","slug":"通过Java操作ActiveMQ的代码记录","date":"2018-12-11T10:27:40.000Z","updated":"2018-12-11T10:27:40.790Z","comments":true,"path":"api/articles/通过Java操作ActiveMQ的代码记录.json","excerpt":"","keywords":null,"cover":null,"content":"<p>ActiveMQ的数据发送类<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.DeliveryMode;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.Destination;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageProducer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.Session;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.TextMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.pool.PooledConnection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.pool.PooledConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ActiveMQSend</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String ip;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String port;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> PooledConnection pooledConnection;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 构造方法（传入需要连接的IP和端口）</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ip （AvctiveMQ的服务IP）</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> port （ActiveMQ的服务端口）</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ActiveMQSend</span><span class=\"params\">(String ip, String port)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.ip = ip;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.port = port;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 初始化ActiveMQ的连接池</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            String[] ips = <span class=\"keyword\">this</span>.ip.split(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">            String[] ports = <span class=\"keyword\">this</span>.port.split(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">            StringBuilder tcpLink = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; ips.length; i++) &#123;</span><br><span class=\"line\">                tcpLink.append(<span class=\"string\">\"tcp://\"</span>).append(ips[i]).append(<span class=\"string\">\":\"</span>).append(ports[i]).append(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            String mqLink = tcpLink.toString();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (tcpLink.length() &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"string\">','</span> == tcpLink.charAt(tcpLink.length() - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                    mqLink = tcpLink.substring(<span class=\"number\">0</span>, tcpLink.length() - <span class=\"number\">1</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            String url = String.format(<span class=\"string\">\"failover:(%s)?initialReconnectDelay=1000&amp;timeout=3000&amp;startupMaxReconnectAttempts=2\"</span>, mqLink);</span><br><span class=\"line\">            ActiveMQConnectionFactory factory = <span class=\"keyword\">new</span> ActiveMQConnectionFactory(url);</span><br><span class=\"line\">            factory.setMaxThreadPoolSize(<span class=\"number\">50</span>);</span><br><span class=\"line\">            PooledConnectionFactory poolFactory = <span class=\"keyword\">new</span> PooledConnectionFactory(factory);</span><br><span class=\"line\">            pooledConnection = (PooledConnection) poolFactory.createConnection();</span><br><span class=\"line\">            pooledConnection.start();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.destroy();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 向ActiveMQ中发送数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> needSendMsg 需要发送的数据信息</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sendMQName 需要发送到的队列名称</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">send</span><span class=\"params\">(String needSendMsg, String sendMQName)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.pooledConnection == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.pooledConnection != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Session session = <span class=\"keyword\">this</span>.pooledConnection.createSession(Boolean.FALSE, Session.AUTO_ACKNOWLEDGE);</span><br><span class=\"line\">                Destination destination = session.createQueue(sendMQName);</span><br><span class=\"line\">                MessageProducer producer = session.createProducer(destination);</span><br><span class=\"line\">                producer.setDeliveryMode(DeliveryMode.PERSISTENT);</span><br><span class=\"line\">                TextMessage message = session.createTextMessage(needSendMsg);</span><br><span class=\"line\">                producer.send(message);</span><br><span class=\"line\">                session.close();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">                LogUtil.error(ex);</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.destroy();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 回收连接池</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">destroy</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pooledConnection != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                pooledConnection.stop();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            LogUtil.error(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pooledConnection != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                pooledConnection.close();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            LogUtil.error(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        pooledConnection = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>调用发送<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Thread t1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                ActiveMQSend sen = <span class=\"keyword\">new</span> ActiveMQSend(<span class=\"string\">\"127.0.0.1\"</span>, <span class=\"string\">\"61616\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">50000</span>; i++) &#123;</span><br><span class=\"line\">                    String msg = String.format(<span class=\"string\">\"这是TestQueue 2 第 %s 条发送的数据！\"</span>, i);</span><br><span class=\"line\">                    sen.send(msg, <span class=\"string\">\"TestQueue2\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        Thread t2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                ActiveMQSend sen = <span class=\"keyword\">new</span> ActiveMQSend(<span class=\"string\">\"127.0.0.1\"</span>, <span class=\"string\">\"61616\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">50000</span>; i++) &#123;</span><br><span class=\"line\">                    String msg = String.format(<span class=\"string\">\"这是TestQueue 1 第 %s 条发送的数据！\"</span>, i);</span><br><span class=\"line\">                    sen.send(msg, <span class=\"string\">\"TestQueue1\"</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>ActiveMQ数据接收类<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.MessageConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.Destination;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.Session;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.jms.TextMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.ActiveMQConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.pool.PooledConnection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.activemq.pool.PooledConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Receiver</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> PooledConnection pooledConnection;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            String url = <span class=\"string\">\"failover:(tcp://192.168.10.219:61616)?initialReconnectDelay=1000&amp;timeout=3000&amp;startupMaxReconnectAttempts=2\"</span>;</span><br><span class=\"line\">            ActiveMQConnectionFactory factory = <span class=\"keyword\">new</span> ActiveMQConnectionFactory(url);</span><br><span class=\"line\">            factory.setMaxThreadPoolSize(<span class=\"number\">100</span>);</span><br><span class=\"line\">            PooledConnectionFactory poolFactory = <span class=\"keyword\">new</span> PooledConnectionFactory(factory);</span><br><span class=\"line\">            pooledConnection = (PooledConnection) poolFactory.createConnection();</span><br><span class=\"line\">            pooledConnection.start();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            Log.error(ex);</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.destroy();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">receive</span><span class=\"params\">(String queueName)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.pooledConnection == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">this</span>.init();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.pooledConnection != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Session session = <span class=\"keyword\">this</span>.pooledConnection.createSession(Boolean.FALSE, Session.AUTO_ACKNOWLEDGE);</span><br><span class=\"line\">                Destination destination = session.createQueue(queueName);</span><br><span class=\"line\">                MessageConsumer consumer = session.createConsumer(destination);</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">                    TextMessage message = (TextMessage) consumer.receive(<span class=\"number\">10</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != message) &#123;</span><br><span class=\"line\">                        System.out.println(<span class=\"string\">\"收到消息\"</span> + message.getText());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">                Log.info(ex.getMessage());</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.destroy();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">destroy</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pooledConnection != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                pooledConnection.stop();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            Log.error(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (pooledConnection != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                pooledConnection.close();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            Log.error(e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        pooledConnection = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>数据接收类的调用<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        Thread t1 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                Receiver r1 = <span class=\"keyword\">new</span> Receiver();</span><br><span class=\"line\">                r1.receive(<span class=\"string\">\"TestQueue2\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        Thread t2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Runnable() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                Receiver r2 = <span class=\"keyword\">new</span> Receiver();</span><br><span class=\"line\">                r2.receive(<span class=\"string\">\"TestQueue1\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div></p>\n","text":"ActiveMQ的数据发送类<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"activemq","slug":"java/activemq","count":1,"path":"api/categories/java/activemq.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"activemq","slug":"activemq","count":1,"path":"api/tags/activemq.json"}]},{"title":"使用SpringBoot和Dubbo开发分布式系统","slug":"使用SpringBoot和Dubbo开发分布式系统","date":"2018-12-11T09:48:39.000Z","updated":"2018-12-11T09:48:39.879Z","comments":true,"path":"api/articles/使用SpringBoot和Dubbo开发分布式系统.json","excerpt":"","keywords":null,"cover":null,"content":"<p>首先我们先建立一个文件夹 demo 作为项目的存放目录 </p>\n<p>其次我们建立三个maven的jar项目</p>\n<p>分别为 demo-lib, demo-db, demo-web</p>\n<p>![image][<a href=\"https://static.oschina.net/uploads/space/2017/0517/100633_8H1J_2370543.png]\" target=\"_blank\" rel=\"noopener\">https://static.oschina.net/uploads/space/2017/0517/100633_8H1J_2370543.png]</a></p>\n<p>![image][<a href=\"https://static.oschina.net/uploads/space/2017/0517/100649_YQLE_2370543.png]\" target=\"_blank\" rel=\"noopener\">https://static.oschina.net/uploads/space/2017/0517/100649_YQLE_2370543.png]</a></p>\n<p>![image][<a href=\"https://static.oschina.net/uploads/space/2017/0517/100709_UJyB_2370543.png]\" target=\"_blank\" rel=\"noopener\">https://static.oschina.net/uploads/space/2017/0517/100709_UJyB_2370543.png]</a></p>\n<p>lib 用于 提供web和db互通的数据接口和接口</p>\n<p>web 用于 提供网站访问</p>\n<p>db 用于提供数据支持</p>\n<p>我们为了便于管理 使用 maven 的 parent 配置, 在demo 文件夹中 建立一个 pom.xml 文件 并写入以下内容:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>$&#123;project.artifactId&#125;<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>The parent project of demo<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.3.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-lib<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-db<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-web<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.source</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.target</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>dubbo<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5.4-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span>  </span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span>  </span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span>  </span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span>  </span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span>  </span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.guava<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>guava<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>21.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.code.gson<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>gson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.zookeeper<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zookeeper<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.3.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.sgroschupf<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>zkclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.thoughtworks.xstream<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>xstream<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>fastjson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.24<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">compilerArgument</span>&gt;</span>-parameters<span class=\"tag\">&lt;/<span class=\"name\">compilerArgument</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>$&#123;maven.compiler.source&#125;<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>$&#123;maven.compiler.target&#125;<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>spring-milestones<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Spring Milestones<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>https://repo.spring.io/libs-milestone<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">snapshots</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">repository</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">repositories</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>其次 demo-lib , demo-db , demo-web 分别配置 pom.xml<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- demo-lib 的 pom.xml 配置 --&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-lib<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- demo-db 的 pom.xml 配置 --&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-db<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-lib<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;project.parent.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- demo-web 的 pom.xml 配置 --&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.demo<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-lib<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;project.parent.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>demo-web<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span>  </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">defaultGoal</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">defaultGoal</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>配置好了pom.xml文件后 项目结构就出来了</p>\n<p>现在,我们在 Lib 中建立一个 Data 名为 Test (注意:结构需要可序列化 Serializable)</p>\n<p>再建立一个 接口 为 TestService</p>\n<p>在db模块中实现TestServiceImpl</p>\n<p>在web中使用TestService</p>\n<p>db模块中实现后需要注册到zookeeper中 需要设置 提供方的配置文件:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">\"http://code.alibabatech.com/schema/dubbo\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">        http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 提供方应用信息，用于计算依赖关系 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">\"provider-of-demo\"</span>  /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 使用multicast广播注册中心暴露服务地址 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">\"zookeeper://192.168.80.251:2181?backup=192.168.80.252:2181,192.168.80.253:2181,192.168.80.254:2181\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 用dubbo协议在20880端口暴露服务,同一个机子上启动多个需要配置不同的 port --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:protocol</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dubbo\"</span> <span class=\"attr\">port</span>=<span class=\"string\">\"20881\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 和本地bean一样实现服务 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"testService\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.demo.db.service.TestServiceImpl\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 声明需要暴露的服务接口 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:service</span> <span class=\"attr\">interface</span>=<span class=\"string\">\"com.demo.lib.service.TestService\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"testService\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>web模块使用需要 设置 使用方的 配置文件:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:dubbo</span>=<span class=\"string\">\"http://code.alibabatech.com/schema/dubbo\"</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 消费方应用名，用于计算依赖关系，不是匹配条件，不要与提供方一样 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:application</span> <span class=\"attr\">name</span>=<span class=\"string\">\"web-of-demo\"</span>  /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 使用multicast广播注册中心暴露发现服务地址 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:registry</span> <span class=\"attr\">address</span>=<span class=\"string\">\"zookeeper://192.168.80.253:2181?backup=192.168.80.252:2181,192.168.80.251:2181,192.168.80.254:2181\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- 生成远程服务代理，可以和本地bean一样使用demoService --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dubbo:reference</span> <span class=\"attr\">id</span>=<span class=\"string\">\"TestService\"</span> <span class=\"attr\">interface</span>=<span class=\"string\">\"com.demo.lib.service.TestService\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>完成后使用SpringBoot的启动方式启动:</p>\n<p>db模块的启动方式:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@ImportResource</span>(<span class=\"string\">\"classpath:provider.xml\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Launcher</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Launcher.class, args);</span><br><span class=\"line\">        Thread t = <span class=\"keyword\">new</span> Thread(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    Thread.sleep(Long.MAX_VALUE);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        t.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>web模块的启动方式:<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@ImportResource</span>(<span class=\"string\">\"classpath:consumer.xml\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Launcher</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Launcher.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>启动完成后的测试效果:</p>\n<p>![image][<a href=\"https://static.oschina.net/uploads/space/2017/0517/102613_Da10_2370543.png]\" target=\"_blank\" rel=\"noopener\">https://static.oschina.net/uploads/space/2017/0517/102613_Da10_2370543.png]</a></p>\n<p>![image][<a href=\"https://static.oschina.net/uploads/space/2017/0517/102627_sO9N_2370543.png]\" target=\"_blank\" rel=\"noopener\">https://static.oschina.net/uploads/space/2017/0517/102627_sO9N_2370543.png]</a></p>\n<p>![image][<a href=\"https://static.oschina.net/uploads/space/2017/0517/102638_0BKb_2370543.png]\" target=\"_blank\" rel=\"noopener\">https://static.oschina.net/uploads/space/2017/0517/102638_0BKb_2370543.png]</a></p>\n<p>![image][<a href=\"https://static.oschina.net/uploads/space/2017/0517/102650_hUBA_2370543.png]\" target=\"_blank\" rel=\"noopener\">https://static.oschina.net/uploads/space/2017/0517/102650_hUBA_2370543.png]</a></p>\n<p>大家可以动手实验一下,本次使用的是zookeeper做注册发现服务,安装方式请参阅之前的blog内容</p>\n<p>地址: <a href=\"https://my.oschina.net/Kxvz/blog/718483\" target=\"_blank\" rel=\"noopener\">https://my.oschina.net/Kxvz/blog/718483</a></p>\n<p>此Demo源码地址: <a href=\"https://github.com/KevinAtlans/SpringDemo/tree/master/SpringDubbo/Demo\" target=\"_blank\" rel=\"noopener\">https://github.com/KevinAtlans/SpringDemo/tree/master/SpringDubbo/Demo</a></p>\n","text":"首先我们先建立一个文件夹 demo 作为项目的存放目录 其次我们建立三个maven的jar项目分别为 demo-lib, demo-db, demo-web![image][https://static.oschina.net/uploads/space/2017/0517/10","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"Spring","slug":"java/Spring","count":2,"path":"api/categories/java/Spring.json"},{"name":"dubbo","slug":"java/Spring/dubbo","count":1,"path":"api/categories/java/Spring/dubbo.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"spring-boot","slug":"spring-boot","count":3,"path":"api/tags/spring-boot.json"},{"name":"dubbo","slug":"dubbo","count":1,"path":"api/tags/dubbo.json"},{"name":"分布式","slug":"分布式","count":1,"path":"api/tags/分布式.json"}]},{"title":"关于Java去连接HTTP地址的操作","slug":"关于Java去连接HTTP地址的操作","date":"2018-12-11T10:36:15.000Z","updated":"2018-12-11T10:36:15.250Z","comments":true,"path":"api/articles/关于Java去连接HTTP地址的操作.json","excerpt":"","keywords":null,"cover":null,"content":"<p>使用HTTPClient进行操作,可以忽略SSL</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2015-7-28 19:47:16</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HTTPClient</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//HTTP请求读取超时时间</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> SOCKET_TIME_OUT = <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"comment\">//HTTP请求连接时间</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CONNECT_TIME_OUT = <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"comment\">//请求重试次数</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> RETRY_TIMES = <span class=\"number\">3</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">     <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> address 请求地址</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> method  请求方式</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> params 请求参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> paramSendType 发送类型</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> cookies 设置cookies值发送</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">request</span><span class=\"params\">(String address, String method, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        address = address.trim();</span><br><span class=\"line\">        CloseableHttpResponse closeableHttpResponse = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (SupportProtocol.HTTP_METHOD_GET.equalsIgnoreCase(method)) &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.GET(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.HTTP_METHOD_POST.equalsIgnoreCase(method)) &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.POST(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.HTTP_METHOD_PUT.equalsIgnoreCase(method)) &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.PUT(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.POST(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.buildReponseMsg(closeableHttpResponse);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpResponse <span class=\"title\">PUT</span><span class=\"params\">(String address, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            URI uri = URI.create(address);</span><br><span class=\"line\">            HttpPut httpPut = <span class=\"keyword\">new</span> HttpPut(uri);</span><br><span class=\"line\">            RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(SOCKET_TIME_OUT).setConnectTimeout(CONNECT_TIME_OUT).build();</span><br><span class=\"line\">            httpPut.setConfig(requestConfig);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_JSON);</span><br><span class=\"line\">                httpPut.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/xml; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_XML);</span><br><span class=\"line\">                httpPut.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_FORM_URLENCODED);</span><br><span class=\"line\">                httpPut.setEntity(entity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StrUtil.isNotEmpty(cookies)) &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Cookie\"</span>, cookies);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (address.toLowerCase().startsWith(<span class=\"string\">\"https\"</span>)) &#123;</span><br><span class=\"line\">                httpClient = <span class=\"keyword\">this</span>.createSSLClientDefault();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> httpClient.execute(httpPut);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpResponse <span class=\"title\">GET</span><span class=\"params\">(String address, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            URI uri;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (EmptyUtil.isNotEmpty(params)) &#123;</span><br><span class=\"line\">                uri = URI.create(String.format(<span class=\"string\">\"%s?%s\"</span>, address, params));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                uri = URI.create(address);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            HttpGet httpGet = <span class=\"keyword\">new</span> HttpGet(uri);</span><br><span class=\"line\">            RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(SOCKET_TIME_OUT).setConnectTimeout(CONNECT_TIME_OUT).build();</span><br><span class=\"line\">            httpGet.setConfig(requestConfig);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json; charset=UTF-8\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_XML.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/xml; charset=UTF-8\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StrUtil.isNotEmpty(cookies)) &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Cookie\"</span>, cookies);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (address.toLowerCase().startsWith(<span class=\"string\">\"https\"</span>)) &#123;</span><br><span class=\"line\">                httpClient = <span class=\"keyword\">this</span>.createSSLClientDefault();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> httpClient.execute(httpGet);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpResponse <span class=\"title\">POST</span><span class=\"params\">(String address, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            URI uri = URI.create(address);</span><br><span class=\"line\">            HttpPost httpPost = <span class=\"keyword\">new</span> HttpPost(uri);</span><br><span class=\"line\">            RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(SOCKET_TIME_OUT).setConnectTimeout(CONNECT_TIME_OUT).build();</span><br><span class=\"line\">            httpPost.setConfig(requestConfig);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_JSON);</span><br><span class=\"line\">                httpPost.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_XML.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/xml; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_XML);</span><br><span class=\"line\">                httpPost.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_FORM_URLENCODED);</span><br><span class=\"line\">                httpPost.setEntity(entity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StrUtil.isNotEmpty(cookies)) &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Cookie\"</span>, cookies);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (address.toLowerCase().startsWith(<span class=\"string\">\"https\"</span>)) &#123;</span><br><span class=\"line\">                httpClient = <span class=\"keyword\">this</span>.createSSLClientDefault();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> httpClient.execute(httpPost);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpClient <span class=\"title\">createSSLClientDefault</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            SSLContext sslContext = <span class=\"keyword\">new</span> SSLContextBuilder().loadTrustMaterial(<span class=\"keyword\">null</span>, <span class=\"keyword\">new</span> TrustStrategy() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTrusted</span><span class=\"params\">(X509Certificate[] chain,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                        String authType)</span> <span class=\"keyword\">throws</span> CertificateException </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;).build();</span><br><span class=\"line\">            SSLSocketFactory ssf = <span class=\"keyword\">new</span> SSLSocketFactory(sslContext, SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> HttpClients.custom().setSSLSocketFactory(ssf).build();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            LogUtil.error(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HttpClients.createDefault();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">buildReponseMsg</span><span class=\"params\">(CloseableHttpResponse closeableHttpResponse)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (closeableHttpResponse == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> code = closeableHttpResponse.getStatusLine().getStatusCode();</span><br><span class=\"line\">            String msg = EntityUtils.toString(closeableHttpResponse.getEntity());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (code == HttpStatus.SC_OK) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>使用URLConnection读取数据,访问HTTPS貌似有问题</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStreamWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.UnsupportedEncodingException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLConnection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLEncoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Connector</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">GET</span><span class=\"params\">(String address, Map&lt;String, String&gt; params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        String param = <span class=\"keyword\">this</span>.buildParams(params);</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address + <span class=\"string\">\"?\"</span> + param);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">GET</span><span class=\"params\">(String address, String params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address + <span class=\"string\">\"?\"</span> + params);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">POST</span><span class=\"params\">(String address, Map&lt;String, String&gt; params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        String param = <span class=\"keyword\">this</span>.buildParams(params);</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.postData(conn, param);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">POST</span><span class=\"params\">(String address, String param)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.postData(conn, param);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">buildParams</span><span class=\"params\">(Map&lt;String, String&gt; params)</span> <span class=\"keyword\">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class=\"line\">        StringBuilder sb = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;String, String&gt; param : params.entrySet()) &#123;</span><br><span class=\"line\">            sb.append(param.getKey()).append(<span class=\"string\">\"=\"</span>);</span><br><span class=\"line\">            sb.append(URLEncoder.encode(param.getValue(), <span class=\"string\">\"UTF-8\"</span>));</span><br><span class=\"line\">            sb.append(<span class=\"string\">\"&amp;\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sb.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">postData</span><span class=\"params\">(<span class=\"keyword\">final</span> URLConnection conn, String requestData)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        conn.setDoOutput(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">        OutputStreamWriter wr = <span class=\"keyword\">new</span> OutputStreamWriter(conn.getOutputStream());</span><br><span class=\"line\">        wr.write(requestData);</span><br><span class=\"line\">        wr.flush();</span><br><span class=\"line\">        wr.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">readData</span><span class=\"params\">(<span class=\"keyword\">final</span> URLConnection conn)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        String responseData = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        BufferedReader rd = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(conn.getInputStream(), <span class=\"string\">\"UTF-8\"</span>));</span><br><span class=\"line\">        String line;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((line = rd.readLine()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            responseData += line;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        responseData = <span class=\"keyword\">new</span> String(responseData.getBytes(), <span class=\"string\">\"UTF-8\"</span>);</span><br><span class=\"line\">        rd.close();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> responseData;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>做个代码记录 Maven引用<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore-nio<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n","text":"使用HTTPClient进行操作,可以忽略SSL1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"http","slug":"java/http","count":1,"path":"api/categories/java/http.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"http","slug":"http","count":1,"path":"api/tags/http.json"}]},{"title":"在Java代码中使用Spring WebSocket","slug":"在Java代码中使用Spring-WebSocket","date":"2018-12-11T09:13:27.000Z","updated":"2018-12-11T09:15:51.349Z","comments":true,"path":"api/articles/在Java代码中使用Spring-WebSocket.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"在Java代码中使用Spring-WebSocket\"><a href=\"#在Java代码中使用Spring-WebSocket\" class=\"headerlink\" title=\"在Java代码中使用Spring WebSocket\"></a>在Java代码中使用Spring WebSocket</h1><p>首先 pom.xml<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.websocket<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.websocket-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-websocket<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>接收消息后的处理类 GameHandler :<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.net.URI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.BinaryMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.CloseStatus;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.PongMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.TextMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.WebSocketSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.handler.AbstractWebSocketHandler;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GameHandler</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractWebSocketHandler</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 处理字符串类的信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">handleTextMessage</span><span class=\"params\">(WebSocketSession session, TextMessage message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        session.sendMessage(<span class=\"keyword\">new</span> TextMessage(message.asBytes()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 处理二进制类的信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">handleBinaryMessage</span><span class=\"params\">(WebSocketSession session, BinaryMessage message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        session.sendMessage(<span class=\"keyword\">new</span> BinaryMessage(message.getPayload()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ping-pong</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">handlePongMessage</span><span class=\"params\">(WebSocketSession session, PongMessage message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 传出错误的处理</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> exception</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleTransportError</span><span class=\"params\">(WebSocketSession session, Throwable exception)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 连接关闭的处理</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> status</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterConnectionClosed</span><span class=\"params\">(WebSocketSession session, CloseStatus status)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 连接建立后的处理</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterConnectionEstablished</span><span class=\"params\">(WebSocketSession session)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>握手信息拦截器  WebSocketHandshakeInterceptor :</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.Cookie;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.server.ServletServerHttpRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.server.HandshakeInterceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebSocketHandshakeInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">HandshakeInterceptor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">beforeHandshake</span><span class=\"params\">(ServerHttpRequest request, ServerHttpResponse shr1, WebSocketHandler wsh, Map&lt;String, Object&gt; attributes)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 此处可以做一些权限认证的事情或者其他</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterHandshake</span><span class=\"params\">(ServerHttpRequest shr, ServerHttpResponse shr1, WebSocketHandler wsh, Exception excptn)</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>使用WebSocket的配置类  WebSocketConfig :</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebSocket</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebSocketConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurerAdapter</span> <span class=\"keyword\">implements</span> <span class=\"title\">WebSocketConfigurer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerWebSocketHandlers</span><span class=\"params\">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 允许连接的域,只能以http或https开头</span></span><br><span class=\"line\">        String[] allowsOrigins = &#123;<span class=\"string\">\"http://127.0.0.1:1213\"</span>, <span class=\"string\">\"http://localhost:1213\"</span>&#125;;</span><br><span class=\"line\">        registry.addHandler(gameHandler(),<span class=\"string\">\"/game\"</span>).addInterceptors(handshakeInterceptor()).setAllowedOrigins(allowsOrigins);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> GameHandler <span class=\"title\">gameHandler</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> GameHandler();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> WebSocketHandshakeInterceptor <span class=\"title\">handshakeInterceptor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> WebSocketHandshakeInterceptor();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>启动类 Launcher  : </p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Launcher</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] params)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Launcher.class, params);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>配置文件 main/resources/application.properties:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.port=1213</span><br><span class=\"line\">server.session-timeout=1800</span><br><span class=\"line\">server.undertow.io-threads=4</span><br><span class=\"line\">server.undertow.worker-threads=20</span><br><span class=\"line\">server.undertow.buffer-size=1024</span><br><span class=\"line\">server.undertow.buffers-per-region=1024</span><br><span class=\"line\">server.undertow.direct-buffers=true</span><br></pre></td></tr></table></figure></p>\n<p>前端的测试页面 main\\resources\\static\\index.html</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"HTML\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"zh-CN\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"IE=edge\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Platform Gateway<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--&lt;link href=\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" rel=\"stylesheet\"&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.bootcss.com/jquery-scrollTo/2.1.2/jquery.scrollTo.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.6/pako.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--[if lt IE 9]&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;script src=\"https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js\"&gt;&lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;script src=\"https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js\"&gt;&lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;![endif]--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"undefined\">            #message&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                height: 600px;</span></span><br><span class=\"line\"><span class=\"undefined\">                overflow-y:auto;</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>WebSocket Test Page<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">hr</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-inline\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-group\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">\"wsAddr\"</span>&gt;</span>WebSocket Address: <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"input-group\"</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"input-group-addon\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"basic-ws\"</span>&gt;</span>ws://127.0.0.1:1213/<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"basic-ws-addr\"</span> <span class=\"attr\">aria-describedby</span>=<span class=\"string\">\"basic-ws\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"game\"</span> <span class=\"attr\">data-container</span>=<span class=\"string\">\"body\"</span>  <span class=\"attr\">data-placement</span>=<span class=\"string\">\"top\"</span> <span class=\"attr\">data-content</span>=<span class=\"string\">\"链接地址不能为空,请填写\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btnConnect\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"btn btn-primary\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"connect();\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"glyphicon glyphicon-resize-small\"</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                    连接</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btnClose\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"btn btn-danger\"</span> <span class=\"attr\">disabled</span>=<span class=\"string\">\"disabled\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"closeWebSocket();\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"glyphicon glyphicon-remove\"</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                    断开</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btnSend\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"btn btn-info\"</span> <span class=\"attr\">disabled</span>=<span class=\"string\">\"disabled\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left: 50px;\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"send();\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"glyphicon glyphicon-transfer\"</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                    发送消息</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">textarea</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"inMsg\"</span> <span class=\"attr\">rows</span>=<span class=\"string\">\"5\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"在这里输入需要发送的信息...\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">textarea</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">hr</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"message\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">zip</span>(<span class=\"params\">str</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> binaryString = pako.gzip(str, &#123;<span class=\"attr\">to</span>: <span class=\"string\">'string'</span>&#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> btoa(binaryString);</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unzip</span>(<span class=\"params\">b64Data</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> strData = atob(b64Data);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> charData = strData.split(<span class=\"string\">''</span>).map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            <span class=\"keyword\">return</span> x.charCodeAt(<span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> binData = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(charData);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> data = pako.inflate(binData);</span></span><br><span class=\"line\"><span class=\"javascript\">                        strData = <span class=\"built_in\">String</span>.fromCharCode.apply(<span class=\"literal\">null</span>, <span class=\"keyword\">new</span> <span class=\"built_in\">Uint16Array</span>(data));</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> strData;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">var</span> websocket = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">var</span> wsBaseUrl = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">var</span> wsUrl = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        wsBaseUrl = <span class=\"string\">\"ws://\"</span> + <span class=\"built_in\">window</span>.location.host + <span class=\"string\">\"/\"</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"string\">\"#basic-ws\"</span>).text(wsBaseUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            $(<span class=\"string\">'[data-toggle=\"popover\"]'</span>).popover();</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//关闭WebSocket连接</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">closeWebSocket</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (websocket) &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                            websocket.close();</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//将消息显示在网页上</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setMessageInnerHTML</span>(<span class=\"params\">who, msg</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> message = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (who === <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                            message = '<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"alert alert-success\"</span> <span class=\"attr\">role</span>=<span class=\"string\">\"alert\"</span>&gt;</span>本地: ' + msg + '<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>';</span></span><br><span class=\"line\"><span class=\"javascript\">                        &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                            message = '<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"alert alert-info\"</span> <span class=\"attr\">role</span>=<span class=\"string\">\"alert\"</span>&gt;</span>服务器: ' + msg + '<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>';</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'message'</span>).innerHTML = (<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'message'</span>).innerHTML + message);</span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"string\">\"#message\"</span>).scrollTo(<span class=\"string\">'100%'</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//发送消息</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">send</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (websocket) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            <span class=\"keyword\">var</span> message = $(<span class=\"string\">\"#inMsg\"</span>).val();</span></span><br><span class=\"line\"><span class=\"undefined\">                            websocket.send(zip(message));</span></span><br><span class=\"line\"><span class=\"undefined\">                            setMessageInnerHTML(1, message);</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> url = $(<span class=\"string\">\"#basic-ws-addr\"</span>).val();</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (url.length &lt;= <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            $(<span class=\"string\">'#basic-ws-addr'</span>).popover(<span class=\"string\">'show'</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                            setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                $(<span class=\"string\">'#basic-ws-addr'</span>).popover(<span class=\"string\">'hide'</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                            &#125;, 3000);</span></span><br><span class=\"line\"><span class=\"javascript\">                        &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                            wsUrl = wsBaseUrl + url;</span></span><br><span class=\"line\"><span class=\"javascript\">                            <span class=\"keyword\">if</span> (<span class=\"string\">'WebSocket'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket = <span class=\"keyword\">new</span> WebSocket(wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//连接发生错误的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                    setMessageInnerHTML(<span class=\"number\">0</span>, <span class=\"string\">\"WebSocket连接发生错误 -&gt; \"</span> + wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnConnect\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnClose\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnSend\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//连接成功建立的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onopen = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                    setMessageInnerHTML(<span class=\"number\">0</span>, <span class=\"string\">\"WebSocket连接成功 -&gt; \"</span> + wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnConnect\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnClose\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnSend\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//接收到消息的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                                    setMessageInnerHTML(0, unzip(event.data));</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//连接关闭的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onclose = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                    setMessageInnerHTML(<span class=\"number\">0</span>, <span class=\"string\">\"WebSocket连接关闭 -&gt; \"</span> + wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnConnect\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnClose\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnSend\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"built_in\">window</span>.onbeforeunload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                                    closeWebSocket();</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"javascript\">                            &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                alert(<span class=\"string\">'Not support websocket'</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">window</span>.onload = init();</span></span><br><span class=\"line\"><span class=\"undefined\">        </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>到此就可以使用 WebSocket 进行前后端的通信了,Good Luck.</p>\n","text":"在Java代码中使用Spring WebSocket首先 pom.xml<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>1","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"Spring","slug":"java/Spring","count":2,"path":"api/categories/java/Spring.json"},{"name":"websocket","slug":"java/Spring/websocket","count":1,"path":"api/categories/java/Spring/websocket.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"spring-boot","slug":"spring-boot","count":3,"path":"api/tags/spring-boot.json"},{"name":"SpringWebSocket","slug":"SpringWebSocket","count":1,"path":"api/tags/SpringWebSocket.json"},{"name":"WebSocket","slug":"WebSocket","count":1,"path":"api/tags/WebSocket.json"}]}]}