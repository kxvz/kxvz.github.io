{"name":"test","slug":"java/test","count":1,"postlist":[{"title":"关于测试中使用ArgumentCaptor来验证执行过程中对象的值","slug":"关于测试中使用ArgumentCaptor来验证执行过程中对象的值","date":"2018-12-11T10:07:58.000Z","updated":"2018-12-11T10:07:58.153Z","comments":true,"path":"api/articles/关于测试中使用ArgumentCaptor来验证执行过程中对象的值.json","excerpt":"","keywords":null,"cover":null,"content":"<p>官方的示例：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ArgumentCaptor&lt;Person&gt; argument = ArgumentCaptor.forClass(Person.class);</span><br><span class=\"line\">verify(mock).doSomething(argument.capture());</span><br><span class=\"line\">assertEquals(<span class=\"string\">\"John\"</span>, argument.getValue().getName());</span><br></pre></td></tr></table></figure></div></p>\n<h3 id=\"大体步骤：\"><a href=\"#大体步骤：\" class=\"headerlink\" title=\"大体步骤：\"></a>大体步骤：</h3><p>﻿首先构建ArgumentCaptor需要传入需要被捕获变量的对象，如示例中的Person.class。</p>\n<p>然后在verify调用Mock对象的方法中调用argument.capture()来捕获执行该方法时该变量的值。</p>\n<p>这样取到值后就可以进行值的验证，通过argument.getValue()得到该对象执行时的值。﻿</p>\n<p>关于ArgumentCaptor最多用到的方法：</p>\n<p>argument.capture() 捕获方法参数  </p>\n<p>argument.getValue() 获取方法参数值，如果方法进行了多次调用，它将返回最后一个参数值 </p>\n<p>argument.getAllValues() 方法进行多次调用后，返回多个参数值</p>\n<h3 id=\"注意：\"><a href=\"#注意：\" class=\"headerlink\" title=\"注意：\"></a>注意：</h3><p>在使用的时候需要放在需要执行的方法之后，因为verify会验证执行，所以会放在调用方法之后,而不是像调用Mockito.when()设定条件时放在调用方法之前。</p>\n<p>当遇到复杂对象的时候，如：Map&lt;String,Map&lt;String,Long&gt;&gt; 这样的对象的时候，觉得不好取值，可以设断点调试到该处，查看argument的数据结构，再进行取值验证。</p>\n","text":"官方的示例：<br>1<br>2<br>3<br>ArgumentCaptor&lt;Person&gt; argument = ArgumentCaptor.forClass(Person.class);<br>verify(mock).doSomething(argument","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"test","slug":"java/test","count":1,"path":"api/categories/java/test.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"test","slug":"test","count":1,"path":"api/tags/test.json"},{"name":"ArgumentCaptor","slug":"ArgumentCaptor","count":1,"path":"api/tags/ArgumentCaptor.json"}]}]}