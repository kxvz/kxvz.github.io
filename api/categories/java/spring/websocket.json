{"name":"websocket","slug":"java/Spring/websocket","count":1,"postlist":[{"title":"在Java代码中使用Spring WebSocket","slug":"在Java代码中使用Spring-WebSocket","date":"2018-12-11T09:13:27.000Z","updated":"2018-12-11T09:15:51.349Z","comments":true,"path":"api/articles/在Java代码中使用Spring-WebSocket.json","excerpt":"","keywords":null,"cover":null,"content":"<h1 id=\"在Java代码中使用Spring-WebSocket\"><a href=\"#在Java代码中使用Spring-WebSocket\" class=\"headerlink\" title=\"在Java代码中使用Spring WebSocket\"></a>在Java代码中使用Spring WebSocket</h1><p>首先 pom.xml<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.8.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>commons-io<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.websocket<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>javax.websocket-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-websocket<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<p>接收消息后的处理类 GameHandler :<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.net.URI;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.BinaryMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.CloseStatus;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.PongMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.TextMessage;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.WebSocketSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.handler.AbstractWebSocketHandler;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">GameHandler</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractWebSocketHandler</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 处理字符串类的信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">handleTextMessage</span><span class=\"params\">(WebSocketSession session, TextMessage message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        session.sendMessage(<span class=\"keyword\">new</span> TextMessage(message.asBytes()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 处理二进制类的信息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">handleBinaryMessage</span><span class=\"params\">(WebSocketSession session, BinaryMessage message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        session.sendMessage(<span class=\"keyword\">new</span> BinaryMessage(message.getPayload()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * ping-pong</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">handlePongMessage</span><span class=\"params\">(WebSocketSession session, PongMessage message)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 传出错误的处理</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> exception</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">handleTransportError</span><span class=\"params\">(WebSocketSession session, Throwable exception)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 连接关闭的处理</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> status</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterConnectionClosed</span><span class=\"params\">(WebSocketSession session, CloseStatus status)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 连接建立后的处理</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> session</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterConnectionEstablished</span><span class=\"params\">(WebSocketSession session)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div></p>\n<p>握手信息拦截器  WebSocketHandshakeInterceptor :</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.Cookie;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.http.server.ServletServerHttpRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.server.HandshakeInterceptor;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebSocketHandshakeInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title\">HandshakeInterceptor</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">beforeHandshake</span><span class=\"params\">(ServerHttpRequest request, ServerHttpResponse shr1, WebSocketHandler wsh, Map&lt;String, Object&gt; attributes)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 此处可以做一些权限认证的事情或者其他</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterHandshake</span><span class=\"params\">(ServerHttpRequest shr, ServerHttpResponse shr1, WebSocketHandler wsh, Exception excptn)</span> </span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>使用WebSocket的配置类  WebSocketConfig :</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableWebSocket</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WebSocketConfig</span> <span class=\"keyword\">extends</span> <span class=\"title\">WebMvcConfigurerAdapter</span> <span class=\"keyword\">implements</span> <span class=\"title\">WebSocketConfigurer</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">registerWebSocketHandlers</span><span class=\"params\">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 允许连接的域,只能以http或https开头</span></span><br><span class=\"line\">        String[] allowsOrigins = &#123;<span class=\"string\">\"http://127.0.0.1:1213\"</span>, <span class=\"string\">\"http://localhost:1213\"</span>&#125;;</span><br><span class=\"line\">        registry.addHandler(gameHandler(),<span class=\"string\">\"/game\"</span>).addInterceptors(handshakeInterceptor()).setAllowedOrigins(allowsOrigins);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> GameHandler <span class=\"title\">gameHandler</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> GameHandler();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> WebSocketHandshakeInterceptor <span class=\"title\">handshakeInterceptor</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> WebSocketHandshakeInterceptor();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>启动类 Launcher  : </p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Launcher</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] params)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(Launcher.class, params);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>配置文件 main/resources/application.properties:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server.port=1213</span><br><span class=\"line\">server.session-timeout=1800</span><br><span class=\"line\">server.undertow.io-threads=4</span><br><span class=\"line\">server.undertow.worker-threads=20</span><br><span class=\"line\">server.undertow.buffer-size=1024</span><br><span class=\"line\">server.undertow.buffers-per-region=1024</span><br><span class=\"line\">server.undertow.direct-buffers=true</span><br></pre></td></tr></table></figure></p>\n<p>前端的测试页面 main\\resources\\static\\index.html</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"HTML\"><figure class=\"iseeu highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"zh-CN\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">http-equiv</span>=<span class=\"string\">\"X-UA-Compatible\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"IE=edge\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">\"viewport\"</span> <span class=\"attr\">content</span>=<span class=\"string\">\"width=device-width, initial-scale=1\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Platform Gateway<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">link</span> <span class=\"attr\">href</span>=<span class=\"string\">\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"stylesheet\"</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--&lt;link href=\"https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" rel=\"stylesheet\"&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.bootcss.com/jquery-scrollTo/2.1.2/jquery.scrollTo.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.6/pako.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--[if lt IE 9]&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;script src=\"https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js\"&gt;&lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;script src=\"https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js\"&gt;&lt;/script&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;![endif]--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"undefined\">            #message&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                height: 600px;</span></span><br><span class=\"line\"><span class=\"undefined\">                overflow-y:auto;</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">        </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"container\"</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>WebSocket Test Page<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">hr</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-inline\"</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-group\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">\"wsAddr\"</span>&gt;</span>WebSocket Address: <span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"input-group\"</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"input-group-addon\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"basic-ws\"</span>&gt;</span>ws://127.0.0.1:1213/<span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"basic-ws-addr\"</span> <span class=\"attr\">aria-describedby</span>=<span class=\"string\">\"basic-ws\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"game\"</span> <span class=\"attr\">data-container</span>=<span class=\"string\">\"body\"</span>  <span class=\"attr\">data-placement</span>=<span class=\"string\">\"top\"</span> <span class=\"attr\">data-content</span>=<span class=\"string\">\"链接地址不能为空,请填写\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btnConnect\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"btn btn-primary\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"connect();\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"glyphicon glyphicon-resize-small\"</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                    连接</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btnClose\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"btn btn-danger\"</span> <span class=\"attr\">disabled</span>=<span class=\"string\">\"disabled\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"closeWebSocket();\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"glyphicon glyphicon-remove\"</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                    断开</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"button\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"btnSend\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"btn btn-info\"</span> <span class=\"attr\">disabled</span>=<span class=\"string\">\"disabled\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"margin-left: 50px;\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"send();\"</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"glyphicon glyphicon-transfer\"</span> <span class=\"attr\">aria-hidden</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">                    发送消息</span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">br</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">textarea</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-control\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"inMsg\"</span> <span class=\"attr\">rows</span>=<span class=\"string\">\"5\"</span> <span class=\"attr\">placeholder</span>=<span class=\"string\">\"在这里输入需要发送的信息...\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">textarea</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">hr</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"message\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">\"https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">zip</span>(<span class=\"params\">str</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> binaryString = pako.gzip(str, &#123;<span class=\"attr\">to</span>: <span class=\"string\">'string'</span>&#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> btoa(binaryString);</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unzip</span>(<span class=\"params\">b64Data</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> strData = atob(b64Data);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> charData = strData.split(<span class=\"string\">''</span>).map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            <span class=\"keyword\">return</span> x.charCodeAt(<span class=\"number\">0</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> binData = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(charData);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> data = pako.inflate(binData);</span></span><br><span class=\"line\"><span class=\"javascript\">                        strData = <span class=\"built_in\">String</span>.fromCharCode.apply(<span class=\"literal\">null</span>, <span class=\"keyword\">new</span> <span class=\"built_in\">Uint16Array</span>(data));</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> strData;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">var</span> websocket = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">var</span> wsBaseUrl = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"keyword\">var</span> wsUrl = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">init</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        wsBaseUrl = <span class=\"string\">\"ws://\"</span> + <span class=\"built_in\">window</span>.location.host + <span class=\"string\">\"/\"</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"string\">\"#basic-ws\"</span>).text(wsBaseUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            $(<span class=\"string\">'[data-toggle=\"popover\"]'</span>).popover();</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//关闭WebSocket连接</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">closeWebSocket</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (websocket) &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                            websocket.close();</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//将消息显示在网页上</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">setMessageInnerHTML</span>(<span class=\"params\">who, msg</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> message = <span class=\"literal\">null</span>;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (who === <span class=\"number\">1</span>) &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                            message = '<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"alert alert-success\"</span> <span class=\"attr\">role</span>=<span class=\"string\">\"alert\"</span>&gt;</span>本地: ' + msg + '<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>';</span></span><br><span class=\"line\"><span class=\"javascript\">                        &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"xml\">                            message = '<span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"alert alert-info\"</span> <span class=\"attr\">role</span>=<span class=\"string\">\"alert\"</span>&gt;</span>服务器: ' + msg + '<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span>';</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'message'</span>).innerHTML = (<span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'message'</span>).innerHTML + message);</span></span><br><span class=\"line\"><span class=\"javascript\">                        $(<span class=\"string\">\"#message\"</span>).scrollTo(<span class=\"string\">'100%'</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\"><span class=\"comment\">//发送消息</span></span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">send</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (websocket) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            <span class=\"keyword\">var</span> message = $(<span class=\"string\">\"#inMsg\"</span>).val();</span></span><br><span class=\"line\"><span class=\"undefined\">                            websocket.send(zip(message));</span></span><br><span class=\"line\"><span class=\"undefined\">                            setMessageInnerHTML(1, message);</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">connect</span>(<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">var</span> url = $(<span class=\"string\">\"#basic-ws-addr\"</span>).val();</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">if</span> (url.length &lt;= <span class=\"number\">0</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                            $(<span class=\"string\">'#basic-ws-addr'</span>).popover(<span class=\"string\">'show'</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                            setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                $(<span class=\"string\">'#basic-ws-addr'</span>).popover(<span class=\"string\">'hide'</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                            &#125;, 3000);</span></span><br><span class=\"line\"><span class=\"javascript\">                        &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                            wsUrl = wsBaseUrl + url;</span></span><br><span class=\"line\"><span class=\"javascript\">                            <span class=\"keyword\">if</span> (<span class=\"string\">'WebSocket'</span> <span class=\"keyword\">in</span> <span class=\"built_in\">window</span>) &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket = <span class=\"keyword\">new</span> WebSocket(wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//连接发生错误的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onerror = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                    setMessageInnerHTML(<span class=\"number\">0</span>, <span class=\"string\">\"WebSocket连接发生错误 -&gt; \"</span> + wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnConnect\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnClose\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnSend\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//连接成功建立的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onopen = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                    setMessageInnerHTML(<span class=\"number\">0</span>, <span class=\"string\">\"WebSocket连接成功 -&gt; \"</span> + wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnConnect\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnClose\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnSend\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//接收到消息的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onmessage = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                                    setMessageInnerHTML(0, unzip(event.data));</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//连接关闭的回调方法</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                websocket.onclose = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                    setMessageInnerHTML(<span class=\"number\">0</span>, <span class=\"string\">\"WebSocket连接关闭 -&gt; \"</span> + wsUrl);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnConnect\"</span>).removeAttr(<span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnClose\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">                                    $(<span class=\"string\">\"#btnSend\"</span>).attr(<span class=\"string\">\"disabled\"</span>, <span class=\"string\">\"disabled\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"comment\">//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span></span><br><span class=\"line\"><span class=\"javascript\">                                <span class=\"built_in\">window</span>.onbeforeunload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">                                    closeWebSocket();</span></span><br><span class=\"line\"><span class=\"undefined\">                                &#125;;</span></span><br><span class=\"line\"><span class=\"javascript\">                            &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">                                alert(<span class=\"string\">'Not support websocket'</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">                            &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">                        &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">                    &#125;</span></span><br><span class=\"line\"><span class=\"javascript\">                    <span class=\"built_in\">window</span>.onload = init();</span></span><br><span class=\"line\"><span class=\"undefined\">        </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>到此就可以使用 WebSocket 进行前后端的通信了,Good Luck.</p>\n","text":"在Java代码中使用Spring WebSocket首先 pom.xml<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>1","link":"","raw":null,"photos":[],"categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"Spring","slug":"java/Spring","count":2,"path":"api/categories/java/Spring.json"},{"name":"websocket","slug":"java/Spring/websocket","count":1,"path":"api/categories/java/Spring/websocket.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"spring-boot","slug":"spring-boot","count":3,"path":"api/tags/spring-boot.json"},{"name":"SpringWebSocket","slug":"SpringWebSocket","count":1,"path":"api/tags/SpringWebSocket.json"},{"name":"WebSocket","slug":"WebSocket","count":1,"path":"api/tags/WebSocket.json"}]}]}