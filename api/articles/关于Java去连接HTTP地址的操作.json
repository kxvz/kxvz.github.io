{"title":"关于Java去连接HTTP地址的操作","slug":"关于Java去连接HTTP地址的操作","date":"2018-12-11T10:36:15.000Z","updated":"2018-12-11T10:36:15.250Z","comments":true,"path":"api/articles/关于Java去连接HTTP地址的操作.json","photos":[],"link":"","excerpt":"","covers":null,"content":"<p>使用HTTPClient进行操作,可以忽略SSL</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Date</span> 2015-7-28 19:47:16</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HTTPClient</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//HTTP请求读取超时时间</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> SOCKET_TIME_OUT = <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"comment\">//HTTP请求连接时间</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CONNECT_TIME_OUT = <span class=\"number\">5000</span>;</span><br><span class=\"line\">    <span class=\"comment\">//请求重试次数</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> RETRY_TIMES = <span class=\"number\">3</span>;</span><br><span class=\"line\">    </span><br><span class=\"line\">     <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> address 请求地址</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> method  请求方式</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> params 请求参数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> paramSendType 发送类型</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> cookies 设置cookies值发送</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> </span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">request</span><span class=\"params\">(String address, String method, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        address = address.trim();</span><br><span class=\"line\">        CloseableHttpResponse closeableHttpResponse = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (SupportProtocol.HTTP_METHOD_GET.equalsIgnoreCase(method)) &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.GET(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.HTTP_METHOD_POST.equalsIgnoreCase(method)) &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.POST(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.HTTP_METHOD_PUT.equalsIgnoreCase(method)) &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.PUT(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            closeableHttpResponse = <span class=\"keyword\">this</span>.POST(address, params, paramSendType, cookies);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.buildReponseMsg(closeableHttpResponse);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpResponse <span class=\"title\">PUT</span><span class=\"params\">(String address, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            URI uri = URI.create(address);</span><br><span class=\"line\">            HttpPut httpPut = <span class=\"keyword\">new</span> HttpPut(uri);</span><br><span class=\"line\">            RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(SOCKET_TIME_OUT).setConnectTimeout(CONNECT_TIME_OUT).build();</span><br><span class=\"line\">            httpPut.setConfig(requestConfig);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_JSON);</span><br><span class=\"line\">                httpPut.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/xml; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_XML);</span><br><span class=\"line\">                httpPut.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_FORM_URLENCODED);</span><br><span class=\"line\">                httpPut.setEntity(entity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StrUtil.isNotEmpty(cookies)) &#123;</span><br><span class=\"line\">                httpPut.setHeader(<span class=\"string\">\"Cookie\"</span>, cookies);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (address.toLowerCase().startsWith(<span class=\"string\">\"https\"</span>)) &#123;</span><br><span class=\"line\">                httpClient = <span class=\"keyword\">this</span>.createSSLClientDefault();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> httpClient.execute(httpPut);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpResponse <span class=\"title\">GET</span><span class=\"params\">(String address, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            URI uri;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (EmptyUtil.isNotEmpty(params)) &#123;</span><br><span class=\"line\">                uri = URI.create(String.format(<span class=\"string\">\"%s?%s\"</span>, address, params));</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                uri = URI.create(address);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            HttpGet httpGet = <span class=\"keyword\">new</span> HttpGet(uri);</span><br><span class=\"line\">            RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(SOCKET_TIME_OUT).setConnectTimeout(CONNECT_TIME_OUT).build();</span><br><span class=\"line\">            httpGet.setConfig(requestConfig);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json; charset=UTF-8\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_XML.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/xml; charset=UTF-8\"</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StrUtil.isNotEmpty(cookies)) &#123;</span><br><span class=\"line\">                httpGet.setHeader(<span class=\"string\">\"Cookie\"</span>, cookies);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (address.toLowerCase().startsWith(<span class=\"string\">\"https\"</span>)) &#123;</span><br><span class=\"line\">                httpClient = <span class=\"keyword\">this</span>.createSSLClientDefault();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> httpClient.execute(httpGet);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpResponse <span class=\"title\">POST</span><span class=\"params\">(String address, String params, String paramSendType, String cookies)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            URI uri = URI.create(address);</span><br><span class=\"line\">            HttpPost httpPost = <span class=\"keyword\">new</span> HttpPost(uri);</span><br><span class=\"line\">            RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(SOCKET_TIME_OUT).setConnectTimeout(CONNECT_TIME_OUT).build();</span><br><span class=\"line\">            httpPost.setConfig(requestConfig);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_JSON.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/json; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_JSON);</span><br><span class=\"line\">                httpPost.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (SupportProtocol.SUPPORT_XML.equalsIgnoreCase(paramSendType)) &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/xml; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_XML);</span><br><span class=\"line\">                httpPost.setEntity(entity);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Content-Type\"</span>, <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span>);</span><br><span class=\"line\">                StringEntity entity = <span class=\"keyword\">new</span> StringEntity(params, ContentType.APPLICATION_FORM_URLENCODED);</span><br><span class=\"line\">                httpPost.setEntity(entity);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (StrUtil.isNotEmpty(cookies)) &#123;</span><br><span class=\"line\">                httpPost.setHeader(<span class=\"string\">\"Cookie\"</span>, cookies);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            CloseableHttpClient httpClient = HttpClients.createDefault();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (address.toLowerCase().startsWith(<span class=\"string\">\"https\"</span>)) &#123;</span><br><span class=\"line\">                httpClient = <span class=\"keyword\">this</span>.createSSLClientDefault();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> httpClient.execute(httpPost);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> CloseableHttpClient <span class=\"title\">createSSLClientDefault</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            SSLContext sslContext = <span class=\"keyword\">new</span> SSLContextBuilder().loadTrustMaterial(<span class=\"keyword\">null</span>, <span class=\"keyword\">new</span> TrustStrategy() &#123;</span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTrusted</span><span class=\"params\">(X509Certificate[] chain,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                        String authType)</span> <span class=\"keyword\">throws</span> CertificateException </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;).build();</span><br><span class=\"line\">            SSLSocketFactory ssf = <span class=\"keyword\">new</span> SSLSocketFactory(sslContext, SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> HttpClients.custom().setSSLSocketFactory(ssf).build();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            LogUtil.error(e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HttpClients.createDefault();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">buildReponseMsg</span><span class=\"params\">(CloseableHttpResponse closeableHttpResponse)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (closeableHttpResponse == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> code = closeableHttpResponse.getStatusLine().getStatusCode();</span><br><span class=\"line\">            String msg = EntityUtils.toString(closeableHttpResponse.getEntity());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (code == HttpStatus.SC_OK) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> msg;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">            LogUtil.error(ex);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>使用URLConnection读取数据,访问HTTPS貌似有问题</p>\n<div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"JAVA\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.OutputStreamWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.UnsupportedEncodingException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLConnection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URLEncoder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Kai</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Connector</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">GET</span><span class=\"params\">(String address, Map&lt;String, String&gt; params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        String param = <span class=\"keyword\">this</span>.buildParams(params);</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address + <span class=\"string\">\"?\"</span> + param);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">GET</span><span class=\"params\">(String address, String params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address + <span class=\"string\">\"?\"</span> + params);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">POST</span><span class=\"params\">(String address, Map&lt;String, String&gt; params)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        String param = <span class=\"keyword\">this</span>.buildParams(params);</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.postData(conn, param);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">POST</span><span class=\"params\">(String address, String param)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        URL url = <span class=\"keyword\">new</span> URL(address);</span><br><span class=\"line\">        URLConnection conn = url.openConnection();</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.postData(conn, param);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.readData(conn);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">buildParams</span><span class=\"params\">(Map&lt;String, String&gt; params)</span> <span class=\"keyword\">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class=\"line\">        StringBuilder sb = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Map.Entry&lt;String, String&gt; param : params.entrySet()) &#123;</span><br><span class=\"line\">            sb.append(param.getKey()).append(<span class=\"string\">\"=\"</span>);</span><br><span class=\"line\">            sb.append(URLEncoder.encode(param.getValue(), <span class=\"string\">\"UTF-8\"</span>));</span><br><span class=\"line\">            sb.append(<span class=\"string\">\"&amp;\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sb.toString();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">postData</span><span class=\"params\">(<span class=\"keyword\">final</span> URLConnection conn, String requestData)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        conn.setDoOutput(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">        OutputStreamWriter wr = <span class=\"keyword\">new</span> OutputStreamWriter(conn.getOutputStream());</span><br><span class=\"line\">        wr.write(requestData);</span><br><span class=\"line\">        wr.flush();</span><br><span class=\"line\">        wr.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">readData</span><span class=\"params\">(<span class=\"keyword\">final</span> URLConnection conn)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        String responseData = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        BufferedReader rd = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(conn.getInputStream(), <span class=\"string\">\"UTF-8\"</span>));</span><br><span class=\"line\">        String line;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((line = rd.readLine()) != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            responseData += line;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        responseData = <span class=\"keyword\">new</span> String(responseData.getBytes(), <span class=\"string\">\"UTF-8\"</span>);</span><br><span class=\"line\">        rd.close();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> responseData;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>做个代码记录 Maven引用<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"XML\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpclient<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpcore-nio<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n","categories":[{"name":"java","slug":"java","count":21,"path":"api/categories/java.json"},{"name":"http","slug":"java/http","count":1,"path":"api/categories/java/http.json"}],"tags":[{"name":"java","slug":"java","count":25,"path":"api/tags/java.json"},{"name":"http","slug":"http","count":1,"path":"api/tags/http.json"}]}