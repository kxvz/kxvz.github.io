{"title":"Centos转移Mysql的数据位置","slug":"Centos转移Mysql的数据位置","date":"2018-12-11T10:17:11.000Z","updated":"2018-12-11T10:17:11.470Z","comments":true,"path":"api/articles/Centos转移Mysql的数据位置.json","photos":[],"link":"","excerpt":"","covers":null,"content":"<p>首先，假设我们需要把Mysql的数据存储位置转到到  /data 下面</p>\n<p>第一步：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service mysqld stop</span><br></pre></td></tr></table></figure></div></p>\n<p>第二步：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 备份原来的 mysql</span></span><br><span class=\"line\"></span><br><span class=\"line\">cp -a /var/lib/mysql /var/lib/mysql_bak</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### 转移 mysql</span></span><br><span class=\"line\">cp -a /var/lib/mysql /data/</span><br></pre></td></tr></table></figure></div></p>\n<p>转移完成后我们需要修改一些参数让mysql能使用新的地址：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 备份原来的文件配置信息</span></span><br><span class=\"line\">cp -a /etc/my.cnf /etc/my.cnf_bak</span><br><span class=\"line\"><span class=\"comment\">### 修改原来的配置文件</span></span><br><span class=\"line\">vi /etc/my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### 找到 datadir 并把值修改为 ：  datadir=/data/mysql</span></span><br><span class=\"line\"><span class=\"comment\">### 找到 socket 并把值修改为 ：   socket=/data/mysql/mysql.sock</span></span><br></pre></td></tr></table></figure></div></p>\n<p>修改第二个配置文件：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 备份原来的文件信息</span></span><br><span class=\"line\">cp -a /etc/init.d/mysqld /etc/init.d/mysqld_bak</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### 修改原来的文件信息</span></span><br><span class=\"line\">vi /etc/init.d/mysqld</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### 找到 get_mysql_option mysqld datadir </span></span><br><span class=\"line\"><span class=\"comment\">### 并把值修改为 ： get_mysql_option mysqld datadir \"/data/mysql\"</span></span><br><span class=\"line\"><span class=\"comment\">### 找到 datadir 并把值修改为 ： datadir=\"/data/mysql\"</span></span><br></pre></td></tr></table></figure></div></p>\n<p>配置文件修改完成后建立mysql sock 的软连接<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 进入原来的mysql目录</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /ver/lib/mysql</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### 移除里面的内容</span></span><br><span class=\"line\">rm -rf *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">### 建立 mysql.sock 的软连接</span></span><br><span class=\"line\">ln -s /data/mysql/mysql.sock /var/lib/mysql/mysql.sock</span><br></pre></td></tr></table></figure></div></p>\n<p>启动 mysql<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service mysqld start</span><br></pre></td></tr></table></figure></div></p>\n<p>如果出现权限类的问题：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">### 修改权限错误的文件或文件夹 如修改：/data/mysql 的文件夹权限命令</span></span><br><span class=\"line\">chcon -R -t mysqld_db_t /data/mysql</span><br></pre></td></tr></table></figure></div></p>\n<p>如果修改了相应的文件夹权限还是无法启动</p>\n<p>修改系统的权限验证：<br><div class=\"highlight-wrap\"autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\" contenteditable=\"true\"data-rel=\"BASH\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/selinux/config</span><br><span class=\"line\"><span class=\"comment\">### 找到 SELINUX 并把值修改为： SELINUX=disabled</span></span><br><span class=\"line\">Esc  :wq</span><br><span class=\"line\"><span class=\"comment\">### 修改完成保存后重启系统</span></span><br><span class=\"line\">reboot</span><br></pre></td></tr></table></figure></div></p>\n<p>==注意：以上操作如果是在生产环境中请谨慎操作。。==</p>\n","categories":[{"name":"Centos","slug":"Centos","count":30,"path":"api/categories/Centos.json"},{"name":"mysql","slug":"Centos/mysql","count":2,"path":"api/categories/Centos/mysql.json"}],"tags":[{"name":"Centos","slug":"Centos","count":29,"path":"api/tags/Centos.json"},{"name":"mysql","slug":"mysql","count":10,"path":"api/tags/mysql.json"}]}